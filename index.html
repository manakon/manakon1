<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة من أكون؟</title>
    <style>
        /* الألوان الأساسية والمتغيرات */
        :root {
            --primary-dark-color: #776427; /* اللون البني الغامق الجديد */
            --primary-light-color: #D7C385; /* اللون البيج الفاتح الجديد */
            --text-color: #333; /* لون نص داكن للقراءة الجيدة على الخلفيات الفاتحة */
            --white-text-color: #FFF; /* لون نص أبيض للخلفيات الغامقة */
            
            /* تعديل: اللون الغامق الجديد بشفافية أكثر لخلفيات البوب أب */
            --popup-overlay-color: rgba(119, 100, 39, 0.9); /* اللون البني الغامق بشفافية 90% */
            /* تعديل: اللون الغامق الجديد بشفافية أكبر لبطاقات الشاشات الرئيسية (الأسئلة والنقاط) */
            --card-overlay-color: rgba(119, 100, 39, 0.6); /* اللون البني الغامق بشفافية 60% لظهور الخلفية */

            /* ألوان الفرق لبطاقات عرض النقاط - ألوان فاتحة جداً */
            --team1-card-color: rgba(144, 238, 144, 0.8); /* أخضر فاتح جداً */
            --team2-card-color: rgba(173, 216, 230, 0.8); /* أزرق فاتح جداً */
            --team3-card-color: rgba(255, 255, 153, 0.8); /* أصفر فاتح جداً */
            --team4-card-color: rgba(255, 192, 203, 0.8); /* وردي فاتح جداً */
            --team5-card-color: rgba(221, 160, 221, 0.8); /* بنفسجي فاتح جداً */
            --team6-card-color: rgba(135, 206, 235, 0.8); /* أزرق سماوي فاتح جداً */
        }

        /* أساسيات الجسم والخطوط */
        html, body {
            height: 100%; /* جعل ارتفاع الصفحة 100% من النافذة */
            width: 100%; /* جعل عرض الصفحة 100% من النافذة */
            margin: 0; /* إزالة الهوامش الافتراضية */
            padding: 0; /* إزالة البادينج الافتراضي */
            box-sizing: border-box; /* التأكد من أن البادينج لا يضيف للارتفاع والعرض الكلي */
        }

        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f4f4f4; /* خلفية الصفحة العامة الأصلية */
            direction: rtl; /* لضمان عرض النص من اليمين لليسار */
            text-align: center; /* توسيط جميع النصوص بشكل افتراضي */
            padding: 20px; /* Base padding for larger screens */
            overflow-y: auto; /* تفعيل شريط التمرير للصفحة الرئيسية */
            position: relative; /* للسماح بوضع الخلفية المتناثرة */
        }

        /* خلفية أيقونات الاستفهام الضاحكة */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='80' font-size='90' text-anchor='middle' fill='%23776427' fill-opacity='0.1'%3E%3F%3C/text%3E%3C/svg%3E");
            background-size: 200px 200px; /* حجم الأيقونة الواحدة */
            opacity: 0.6; /* شفافية عامة للخلفية */
            z-index: -1; /* لجعلها خلف المحتوى */
        }

        /* التنبيهات والملاحظات العلوية */
        .top-note {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: var(--primary-dark-color); /* اللون الغامق الجديد */
            color: var(--white-text-color);
            padding: 10px 20px;
            text-align: center;
            font-size: 0.9em;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            box-sizing: border-box; /* Ensure padding is included in the width */
        }

        .top-note strong {
            color: red; /* تلوين كلمة "ملاحظة" بالأحمر */
        }

        /* الأنماط العامة للبطاقات (الشاشات الرئيسية) */
        .card {
            background-color: var(--card-overlay-color); /* اللون الغامق الجديد بشفافية عالية جداً */
            color: var(--white-text-color); /* نص أبيض عليها */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); /* ظل أغمق */
            text-align: center;
            width: 90%; /* Fluid width */
            max-width: 700px; /* Max width for larger screens */
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-sizing: border-box;
            margin-top: 60px; /* مسافة من الملاحظة العلوية */
            margin-bottom: 20px;
            border: 2px solid var(--primary-light-color); /* حدود للبطاقات باللون الفاتح */
            position: relative; /* للسماح بتوسيط المحتوى الداخلي */
            overflow-y: auto; /* إضافة شريط تمرير لهذه البطاقات أيضاً */
        }
        .card h2, .card h3 {
            color: var(--primary-light-color); /* العناوين باللون الفاتح */
            font-size: clamp(1.5rem, 4vw, 2.5rem); /* Responsive font size */
        }
        .card p, .card li, .card label {
            color: var(--white-text-color); /* النصوص باللون الأبيض */
            font-size: clamp(0.9rem, 2vw, 1.1rem); /* Responsive font size */
        }

        /* الأنماط العامة للأزرار */
        .btn {
            background-color: var(--primary-dark-color);
            color: var(--white-text-color);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em; /* Relative font size */
            transition: background-color 0.3s ease, transform 0.1s ease;
            flex-shrink: 0; /* لمنع الأزرار من الانكماش */
            min-width: 120px; /* Ensure a minimum width for touch targets */
        }

        .btn:hover {
            background-color: #927e3d; /* درجة أفتح قليلاً من اللون الغامق عند التفاعل */
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* النوافذ المنبثقة (Popups) */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--popup-overlay-color); /* اللون الغامق الجديد بشفافية عالية */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            overflow-y: auto; /* تفعيل شريط التمرير للنوافذ المنبثقة */
            padding: 10px; /* Padding for the overlay content */
            box-sizing: border-box;
        }

        .popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .popup-content {
            background-color: var(--primary-light-color); /* اللون الفاتح الجديد */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            text-align: center;
            width: 95%; /* Fluid width */
            max-width: 600px; /* Max width for larger screens */
            transform: scale(0.9);
            transition: transform 0.3s ease;
            margin: 20px auto; /* Centering with margin and space from edges */
            border: 2px solid var(--primary-dark-color); /* حدود للبوب أب */
            max-height: 90vh; /* تحديد أقصى ارتفاع للمحتوى المنبثق */
            overflow-y: auto; /* تفعيل شريط التمرير على المحتوى نفسه داخل البوب أب */
            box-sizing: border-box;
        }

        .popup-overlay.active .popup-content {
            transform: scale(1);
        }

        .popup-content h2 {
            color: var(--primary-dark-color);
            margin-bottom: 20px;
            font-size: clamp(1.6rem, 5vw, 2em); /* Responsive font size */
        }

        .popup-content ol, .popup-content ul {
            text-align: center; /* توسيط محتوى القوائم */
            margin: 20px auto;
            max-width: 90%; /* Adjust max-width for lists */
            list-style-position: inside; /* لجعل الترقيم داخل المساحة المحددة */
            padding: 0; /* إزالة البادينج الافتراضي للقائمة */
        }
        .popup-content ul li {
            list-style: none; /* إزالة النقاط أو الأرقام للقوائم غير المرتبة */
            margin-bottom: 5px; /* تقليل المسافة بين عناصر القائمة */
        }

        .popup-content li {
            margin-bottom: 10px;
            line-height: 1.6;
            color: var(--text-color);
            font-size: clamp(0.9rem, 2.5vw, 1.1em); /* Responsive font size */
        }
        .popup-content p {
            color: var(--text-color);
            font-size: clamp(0.9rem, 2.5vw, 1.1em); /* Responsive font size */
        }
        
        /* شاشة الإعدادات */
        #setup-content-wrapper {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .team-selection-grid {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap; /* للسماح للأزرار بالانتقال لسطر جديد إذا ضاقت المساحة */
        }

        .team-selection-grid .btn {
            background-color: var(--primary-light-color);
            color: var(--primary-dark-color);
            border: 2px solid var(--primary-dark-color);
            padding: 10px 20px;
            font-size: 1em;
            flex-grow: 1; /* Allow buttons to grow */
            max-width: 150px; /* Max width for individual buttons */
        }

        .team-selection-grid .btn:hover {
            background-color: #e6d8a7;
        }

        .team-names-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center; /* توسيط حقول إدخال أسماء الفرق */
        }

        .team-input-group {
            display: flex;
            flex-direction: column;
            align-items: center; /* توسيط العنوان وحقل الإدخال */
            gap: 5px;
            width: 100%;
            max-width: 300px; /* تحديد عرض أقصى لحقل الإدخال */
        }

        .team-input-group label {
            font-weight: bold;
            color: var(--primary-light-color); /* لون فاتح للعناوين */
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
        }

        .team-input-group input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--primary-light-color);
            border-radius: 5px;
            font-size: 1em;
            text-align: center; /* توسيط النص داخل حقول الإدخال */
            box-sizing: border-box;
            background-color: rgba(255, 255, 255, 0.2); /* حقول الإدخال شفافة قليلاً */
            color: var(--white-text-color); /* لون النص داخل الحقل */
        }
        .team-input-group input[type="text"]::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        /* شاشة النقاط */
        .score-board {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        /* تعديل: تنسيق Grid للفرق بناءً على العدد */
        .score-board.grid-2x2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        .score-board.grid-2-columns { /* تنسيق 3 صفوف و 2 عمود لـ 6 فرق */
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .team-score-card {
            /* تعديل: ألوان خلفية فاتحة جداً لكل فريق */
            background-color: rgba(215, 195, 133, 0.7); /* لون افتراضي إذا لم يتم تعيين لون خاص */
            color: var(--text-color);
            padding: 20px;
            border-radius: 10px;
            width: 180px; /* حجم ثابت للبطاقات */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 10px;
            min-height: 120px;
            border: 1px solid var(--primary-dark-color);
            transition: background-color 0.3s ease;
            box-sizing: border-box;
            flex-grow: 1; /* Allow cards to grow */
            max-width: 200px; /* Max width for individual score cards */
        }
        /* ألوان الخلفية لبطاقات النقاط لكل فريق - فاتحة جداً وشفافة */
        .team-score-card.team-0-card { background-color: var(--team1-card-color); }
        .team-score-card.team-1-card { background-color: var(--team2-card-color); }
        .team-score-card.team-2-card { background-color: var(--team3-card-color); }
        .team-score-card.team-3-card { background-color: var(--team4-card-color); }
        .team-score-card.team-4-card { background-color: var(--team5-card-color); }
        .team-score-card.team-5-card { background-color: var(--team6-card-color); }


        .team-score-card h3 {
            margin: 0;
            color: var(--primary-dark-color);
            font-size: clamp(1.1rem, 3vw, 1.3em); /* Responsive font size */
        }

        .team-score-card .score {
            font-size: clamp(2rem, 6vw, 2.5em); /* Responsive font size */
            font-weight: bold;
            color: var(--primary-dark-color);
        }

        .score-screen-actions {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        .score-screen-actions .btn {
            flex-grow: 1;
            max-width: 200px; /* Limit button width in action section */
        }

        /* شاشة الأسئلة */
        #question-screen .instruction-text {
            font-size: clamp(1rem, 3vw, 1.2em);
            color: var(--primary-light-color);
            font-weight: bold;
        }

        #question-screen .timer-display {
            font-size: clamp(2.5rem, 8vw, 3em);
            font-weight: bold;
            color: var(--primary-light-color);
            margin: 20px 0;
        }
        #question-screen .pre-question-timer {
            font-size: clamp(3.5rem, 10vw, 4em); /* حجم أكبر لعداد بدء السؤال */
            font-weight: bold;
            color: var(--primary-light-color);
            margin: 20px 0;
        }

        #question-screen .question-text {
            font-size: clamp(1.2rem, 3.5vw, 1.4em);
            min-height: 100px; /* مسافة كافية للسؤال */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            white-space: pre-wrap; /* للحفاظ على تنسيق الأسطر الجديدة */
            transition: color 0.5s ease;
            color: var(--white-text-color); /* لون نص السؤال */
            flex-grow: 1; /* Allow text to take available space */
        }

        #question-screen .question-text.faded {
            color: rgba(255, 255, 255, 0.6); /* بهتان النص ليكون شفافًا أكثر */
        }

        #question-screen .answer-text {
            font-size: clamp(1.1rem, 3vw, 1.3em);
            font-weight: bold;
            color: var(--primary-light-color);
            margin-top: 20px;
            min-height: 50px; /* مسافة كافية للإجابة */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            flex-grow: 0; /* Prevent answer text from growing too much */
        }

        .category-selection-buttons {
            display: none; /* مخفية لأن العداد سيحل محلها */
            justify-content: center;
            margin-top: 20px;
        }

        .question-score-buttons {
            display: none; /* مخفية افتراضياً */
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
        }

        .question-score-buttons .btn {
            color: var(--white-text-color); /* نص أبيض على الأزرار الملونة */
            border: 1px solid rgba(255,255,255,0.3); /* حدود بيضاء شفافة */
            padding: 10px 18px;
            font-size: clamp(0.9rem, 2.5vw, 1em); /* Responsive font size */
            font-weight: bold;
            /* إعادة الألوان الأصلية لأزرار إضافة النقاط */
            background-color: var(--primary-dark-color);
            color: var(--white-text-color);
            border: none;
            flex-grow: 1; /* Allow score buttons to grow */
            max-width: 180px; /* Limit individual score button width */
        }
        /* إزالة قواعد الألوان الخاصة بالفرق من هنا، لتكون الأزرار موحدة */
        .question-score-buttons .btn:hover {
            background-color: #927e3d; /* لون التفاعل للأزرار الموحدة */
        }

        /* زر المتابعة بعد النقاط */
        .question-score-buttons .btn-continue-question {
            background-color: var(--primary-dark-color);
            color: var(--white-text-color);
            border: none;
        }
        .question-score-buttons .btn-continue-question:hover {
            background-color: #927e3d;
        }

        /* شاشة النتائج */
        .winner-message {
            font-size: clamp(1.5rem, 4.5vw, 1.8em);
            font-weight: bold;
            color: var(--primary-light-color);
            margin-bottom: 20px;
            display: flex; /* لتمكين توسيط الأيقونة والنص */
            flex-direction: column; /* ليكون الكأس فوق النص */
            align-items: center; /* توسيط أفقي */
            gap: 10px; /* مسافة بين الكأس والنص */
        }
        .winner-message .trophy-icon {
            font-size: clamp(2.5rem, 8vw, 3em); /* حجم أكبر لأيقونة الكأس */
            color: gold; /* لون ذهبي للكأس */
            animation: bounceIn 0.8s ease-out; /* إضافة حركة دخول */
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        .final-scores-list {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 80%; /* Fluid width for list */
            max-width: 400px; /* Max width for list on larger screens */
            margin: 0 auto 30px auto;
        }

        .final-scores-list li {
            background-color: rgba(215, 195, 133, 0.6); /* اللون الفاتح بشفافية متوسطة */
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: clamp(1rem, 2.8vw, 1.1em);
            color: var(--text-color);
            border: 1px solid var(--primary-dark-color);
        }

        .final-scores-list li span {
            font-weight: bold;
            color: var(--primary-dark-color);
        }

        .result-actions {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        .result-actions .btn {
            flex-grow: 1;
            max-width: 250px; /* Limit button width in action section */
        }

        /* الاستجابة للأجهزة الصغيرة */
        @media (max-width: 768px) { /* Adjust breakpoint for tablets and smaller phones */
            body {
                padding: 10px; /* Reduce padding on smaller screens */
            }
            .card {
                padding: 20px;
                width: 95%;
                margin-top: 55px; /* Adjust for smaller top-note padding */
                gap: 15px;
            }

            .popup-content {
                padding: 20px;
                margin: 10px auto; /* Tighter margins on smaller screens */
            }

            .popup-content h2 {
                font-size: clamp(1.4em, 6vw, 1.8em); /* Slightly larger for phones */
            }

            .popup-content ol, .popup-content ul {
                max-width: 100%; /* Use full width for lists on small screens */
            }

            .btn {
                padding: 10px 15px;
                font-size: 0.9em;
                min-width: unset; /* Remove min-width to allow more flexibility */
                flex-basis: 48%; /* Two buttons per row on small screens */
                margin-bottom: 5px; /* Add some margin between wrapped buttons */
            }
            .team-selection-grid .btn,
            .score-screen-actions .btn,
            .result-actions .btn,
            .question-score-buttons .btn {
                flex-basis: 100%; /* One button per row on very small screens, or adjust based on content */
                max-width: unset; /* Remove max-width for full flexibility */
            }
            .team-selection-grid {
                flex-direction: row; /* Keep as row, let flex-wrap handle it */
                gap: 10px;
            }
            .team-score-card {
                width: 100%;
                max-width: unset; /* Allow cards to take full available width */
                flex-basis: 48%; /* Two cards per row on phones */
                min-height: 100px;
            }

            /* In smaller devices, always a single column for score cards if too narrow */
            .score-board.grid-2x2,
            .score-board.grid-2-columns {
                grid-template-columns: 1fr; /* Single column on small screens */
            }

            #question-screen .timer-display {
                font-size: 2.8em;
            }
            #question-screen .pre-question-timer {
                font-size: 3.8em; /* Adjusted for mobile */
            }

            #question-screen .question-text {
                font-size: 1.1em;
                min-height: 80px;
            }
            #question-screen .answer-text {
                font-size: 1.1em;
                min-height: 40px;
            }

            .winner-message {
                font-size: 1.4em;
            }
            .winner-message .trophy-icon {
                font-size: 2.3em;
            }
            .final-scores-list {
                width: 95%;
            }
            
            /* تعديل لحجم شاشة الترحيب على الجوال */
            #welcome-popup .popup-content img {
                max-width: 60%; /* تصغير الصورة أكثر على الجوال */
            }
        }

        /* Specific adjustments for tablets (iPad, larger phones) */
        @media (min-width: 769px) and (max-width: 1024px) {
            body {
                padding: 15px;
            }
            .card {
                padding: 25px;
                width: 85%;
                max-width: 750px;
            }
            .popup-content {
                padding: 25px;
                max-width: 700px;
            }
            /* تعديل لحجم شاشة الترحيب على التابلت */
            #welcome-popup .popup-content {
                max-width: 500px; /* تصغير عرض نافذة الترحيب على التابلت */
                padding: 25px; /* تعديل البادينج */
            }
            #welcome-popup .popup-content img {
                max-width: 75%; /* تصغير الصورة قليلاً على التابلت */
            }

            .team-selection-grid .btn,
            .score-screen-actions .btn,
            .result-actions .btn {
                flex-basis: auto; /* Allow natural sizing */
                max-width: 180px;
            }
            .score-board.grid-2-columns {
                grid-template-columns: repeat(3, 1fr); /* 3 columns for 6 teams on tablets */
            }
            .team-score-card {
                max-width: 220px;
            }
            .question-score-buttons .btn {
                max-width: 200px;
            }
        }

        /* General adjustments for larger screens (PC) */
        @media (min-width: 1025px) {
            body {
                padding: 30px;
            }
            .card {
                padding: 40px;
                width: 80%;
                max-width: 800px;
            }
            .popup-content {
                padding: 40px;
                max-width: 700px;
            }
            /* تعديل لحجم شاشة الترحيب على الشاشات الكبيرة */
            #welcome-popup .popup-content {
                max-width: 450px; /* تصغير عرض نافذة الترحيب على الشاشات الكبيرة */
                padding: 30px; /* تعديل البادينج */
            }
            #welcome-popup .popup-content img {
                max-width: 70%; /* تصغير الصورة قليلاً على الشاشات الكبيرة */
            }
            .team-selection-grid .btn,
            .score-screen-actions .btn,
            .result-actions .btn {
                max-width: 220px;
            }
            .team-score-card {
                width: 200px; /* Slightly larger fixed size for PC */
                max-width: 250px;
            }
            .question-score-buttons .btn {
                max-width: 220px;
            }
        }

        /* تحديثات لستايل النافذة الترحيبية */
        #welcome-popup .popup-content {
            background-color: #FFFFFF; /* لون خلفية بيضاء لنافذة الترحيب فقط */
            color: var(--text-color); /* نص داكن عليها ليكون مقروءًا */
            display: flex; /* تفعيل فليكس بوكس */
            flex-direction: column; /* ترتيب العناصر عمودياً */
            align-items: center; /* توسيط العناصر أفقياً */
            justify-content: center; /* توسيط العناصر عمودياً */
            gap: 20px; /* مسافة بين العناصر */
        }

        #welcome-popup .popup-content h2 {
            color: var(--primary-dark-color); /* عنوان باللون الغامق ليكون مقروءًا */
            margin-bottom: 0; /* إزالة الهامش السفلي الافتراضي للعنوان */
        }

        #welcome-popup .popup-content img {
            height: auto;
            border-radius: 10px; /* حواف دائرية للصورة */
            margin-bottom: 0; /* إزالة الهامش السفلي إذا كان موجوداً */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--primary-dark-color); /* حدود للصورة باللون الغامق */
        }
        /* لضمان توسيط الزر بشكل مستقل إذا كان هناك نص بعده */
        #welcome-popup .popup-content .btn {
            margin-top: 0; /* إزالة الهامش العلوي إذا كان موجوداً */
        }
    </style>
</head>
<body>

    <div class="top-note">
        <strong>ملاحظة:</strong> هذه النسخه لشخص واحد فقط وتابعة لمتجر همزة كاف لذلك هي غير قابله للنشر او البيع ومن يخالف ذلك سيتم اتخاذ الإجراءات القانونيه في هذا الأمر وللتذكير بذمتك وأمانتك: "قال ﷺ "لا إيمان لمن لا أمانة له، ولا دين لمن لا عهد له"
    </div>

    <div id="welcome-popup" class="popup-overlay">
        <div class="popup-content">
            <h2>أهلاً بك في لعبة "من أكون؟"</h2>
            <img src="https://raw.githubusercontent.com/manakon/manakon1/main/manakon-removebg-preview.png" alt="شعار اللعبة">
            <button class="btn" onclick="showTipsPopupFromWelcome()">التالي</button>
        </div>
    </div>

    <div id="tips-popup" class="popup-overlay">
        <div class="popup-content">
            <h2>نصيحة علشان نلعب ونستانس… بس بدون ما ننسى الأهم 🌙</h2>
            <ol>
                <li>⏰ "اللعب ممتع، بس خلّه بعد الصلاة، عشان ما تضيع عليك فرض."</li>
                <li>📖 "اللعبة حلوة، بس القرآن أحلى، خذ لك وقت بين الجولات وارتّح مع كلام الله."</li>
                <li>🙏 "إذا جاء وقت الصلاة، نوقف اللعب ونكسب رضا رب العالمين."</li>
                <li>✋ "نلعب ونضحك، لكن ما نخلي اللعب يلهينا عن طاعة الله."</li>
                <li>📚 "اللعبة جزء من يومنا، مو كل يومنا… لا تنسى أهدافك وطموحاتك."</li>
                <li>🎯 "اللعبة ما تمنع إنك تذاكر، نظّم وقتك وخلّ اللعب مكافأة بعد الإنجاز."</li>
                <li>⌛ "وقت المذاكرة غالي، لا تخليه يضيع على حساب جيم ممكن تلعبه بأي وقت."</li>
            </ol>
            <p style="text-align: center;">تذكر "إذا لعبت وانت محافظ على صلاتك واذكارك وقراءة القران وخلصت المذاكره والاشغال الي عليك … أنت كسبت الدنيا والآخرة بإذن الله"</p>
            <button class="btn" onclick="showInstructionsPopup()">التالي</button>
        </div>
    </div>

    <div id="instructions-popup" class="popup-overlay">
        <div class="popup-content">
            <h2>تعليمات لعبة "من أكون؟"</h2>
            <h3>💡 فكرة اللعبة:</h3>
            <p>"من أكون؟" هي لعبة جماعية تفاعلية تهدف إلى تنمية الذكاء وسرعة البديهة لدى اللاعبين. تعتمد اللعبة على قدرتك على تخمين شخصية أو عنصر معين من خلال مجموعة من الجمل الوصفية التي تُعرض لك.</p>
            <p>اللعبة مقسمة إلى أربعة أقسام متنوعة وممتعة، كل قسم يحتوي على أنواع مختلفة من الأسئلة:</p>
            <ul>
                <li>👤 <b>شخصيات مهمة</b>: أسئلة تدور حول شخصيات تاريخية، دينية، أو عامة معروفة.</li>
                <li>🍲 <b>طبخات</b>: أسئلة عن أطباق ومأكولات متنوعة من المطبخ العربي والعالمي.</li>
                <li>🐾 <b>حيوانات</b>: أسئلة تصف خصائص وسلوكيات حيوانات مختلفة.</li>
                <li>🗺️ <b>بلدان</b>: أسئلة تصف معالم، ثقافات, أو خصائص دول ومدن.</li>
            </ul>
            <h3>👥 عدد اللاعبين:</h3>
            <p>اللعبة مصممة للعب بين لاعبين أو فرق متعددة. عند بدء اللعبة، يمكنك اختيار عدد الفرق التي ستشارك، الخيارات المتاحة هي:</p>
            <ul>
                <li>فريقين.</li>
                <li>أربعة فرق.</li>
                <li>ستة فرق.</li>
            </ul>
            <p><b>ملاحظة</b>: إذا كنتم تلعبون كأفراد، يمكنكم اعتبار كل لاعب "فريقاً" بحد ذاته.</p>
            <h3>🧠 طريقة اللعب (كيف تلعب):</h3>
            <p>اللعبة بسيطة وممتعة، وتتبع الخطوات التالية في كل جولة:</p>
            <ul>
                <li><b>بدء الدور</b>: تبدأ اللعبة ببدء الجولة 1 وكل جولة سيظهر فيها 4 أسئلة من 4 أقسام مختلفة وهناك عداد للإجابة يجب الإجابة على السؤال قبل انتهاء العداد والفريق الذي يجيب إجابة صحيحة على السؤال يتم تسجيل نقطة له ثم متابعة إلى انتهاء الجولة 1 ومن ثم بدء جولة 2 وهكذا.</li>
                <li><b>شاشة السؤال</b>: ستظهر لك شاشة السؤال التي تمر بثلاث مراحل:
                    <ul>
                        <li><b>الاستعداد (5 ثوانٍ)</b>: يظهر عداد تنازلي مع توضيح السؤال من أي قسم.</li>
                        <li><b>عرض السؤال (20 ثانية)</b>: يظهر السؤال الوصفي على الشاشة مع عداد تنازلي. خلال هذه الفترة، يحاول الفريق الذي عليه الدور تخمين الإجابة بناءً على الجمل المعروضة. وعلى الفرق الإجابة قبل انتهاء العداد.</li>
                    </ul>
                </li>
                <li><b>عرض الإجابة الصحيحة</b>: بمجرد انتهاء العداد، ستظهر الإجابة الصحيحة على الشاشة.</li>
                <li><b>تسجيل النقاط</b>:
                    <ul>
                        <li>إذا كان تخمين الفريق صحيحاً، يُسجل له نقطة واحدة.</li>
                        <li>يمكن للفريق الآخر (أو للمشرف على اللعبة) إضافة النقطة يدوياً للفريق المستحق من شاشة النقاط.</li>
                    </ul>
                </li>
            </ul>
            <h3>📊 شاشة النقاط:</h3>
            <p>هذه هي الشاشة المحورية التي ستعود إليها بعد كل سؤال. تتكون شاشة النقاط من:</p>
            <ul>
                <li><b>مربعات الفرق</b>: لكل فريق مشارك، يوجد مربع خاص به بالاسم.</li>
                <li><b>عرض النقاط</b>: داخل كل مربع، يظهر اسم الفريق ونقاطه الحالية بخط كبير وواضح.</li>
            </ul>
            <p><b>الفائز</b> هو الفريق الذي حصل على أكبر عدد نقاط.</p>
            <p><b>في حال التعادل:</b></p>
            <p>هناك إمكانية "<b>بدء جولة حاسمة</b>": هذا الخيار "ابدأ الجولة الحاسمة" لكسر التعادل وليكون هناك فائز واحد.</p>
            <button class="btn" onclick="hideInstructionsPopup()">بدء الإعدادات</button>
        </div>
    </div>

    <div id="setup-screen" class="card">
        <h2>إعدادات اللعبة</h2>
        <div id="setup-content-wrapper">
            <h3>اختر عدد اللاعبين:</h3>
            <div class="team-selection-grid">
                <button class="btn" onclick="selectNumPlayers(2)">2 لاعبين</button>
                <button class="btn" onclick="selectNumPlayers(4)">4 لاعبين</button>
                <button class="btn" onclick="selectNumPlayers(6)">6 لاعبين</button>
            </div>
            <h3>تسمية الفرق:</h3>
            <div id="team-names-inputs" class="team-names-section">
            </div>
        </div>
        <button class="btn btn-dark" onclick="renameTeams()">إعادة تسمية الفرق</button>
        <button id="start-game-btn" class="btn" style="display: none;" onclick="startGame()">ابدأ اللعبة</button>
    </div>

    <div id="score-screen" class="card">
        <h2>شاشة النقاط</h2>
        <div id="team-score-board" class="score-board">
        </div>
        <div class="score-screen-actions">
            <button id="next-round-btn" class="btn btn-next-round" onclick="startQuestionSequence()">بدء الجولة 1</button>
            <button id="end-game-btn" class="btn btn-end-game" onclick="endGame()">إنهاء اللعب وعرض النتائج</button>
            <button id="reset-game-btn" class="btn btn-reset-game" onclick="resetGame(true)">إعادة تعيين</button>
        </div>
    </div>

    <div id="question-screen" class="card">
        <div class="instruction-text" id="question-instruction"></div>
        <div class="pre-question-timer" id="pre-question-timer" style="display: none;"></div>
        <div class="timer-display" id="question-timer"></div>
        <div class="question-text" id="question-text"></div>
        <div class="answer-text" id="answer-text"></div>
        <div class="category-selection-buttons">
            </div>
        <div class="question-score-buttons">
            </div>
    </div>

    <div id="results-screen" class="card">
        <h2>نتائج اللعبة</h2>
        <div class="winner-message" id="winner-message"></div>
        <ul id="final-scores-list" class="final-scores-list">
            </ul>
        <div class="result-actions">
            <button class="btn" onclick="resetGame(false)">إعادة لعب اللعبة</button>
            <button class="btn" onclick="window.location.reload()">العودة للبداية</button>
        </div>
    </div>

    <script>
        // المتغيرات العامة للعبة
        let currentRound = 0;
        let currentQuestionIndex = 0;
        let teams = []; // { name: 'الفريق 1', score: 0 }
        let questions = [
            // قسم شخصيات مهمة
            { category: "شخصيات مهمة", question: "أنا قائد عظيم وموحد الجزيرة العربية، ومؤسس المملكة العربية السعودية. من أكون؟", answer: "الملك عبدالعزيز آل سعود" },
            { category: "شخصيات مهمة", question: "أنا عالم مسلم وفيلسوف وطبيب، اشتهرت بكتاب القانون في الطب. من أكون؟", answer: "ابن سينا" },
            { category: "شخصيات مهمة", question: "أنا صحابي جليل وقائد عسكري، لقبت بسيف الله المسلول. من أكون؟", answer: "خالد بن الوليد" },
            { category: "شخصيات مهمة", question: "أنا مخترع المصباح الكهربائي وتجاوزت الفشل آلاف المرات. من أكون؟", answer: "توماس إديسون" },
            // قسم طبخات
            { category: "طبخات", question: "أنا طبق شعبي سعودي، أساسي في المناسبات، مكوني الرئيسي الأرز واللحم أو الدجاج. من أكون؟", answer: "الكبسة" },
            { category: "طبخات", question: "أنا حلوى شرقية شهيرة، تتكون من طبقات رقيقة من العجين والمكسرات ومغطاة بالشربات. من أكون؟", answer: "البقلاوة" },
            { category: "طبخات", question: "أنا طبق مكسيكي شهير، يُقدم في خبز التورتيلا مع اللحم والخضروات والصلصات. من أكون؟", answer: "التاكو" },
            { category: "طبخات", question: "أنا شوربة فرنسية غنية، تُقدم عادةً في وعاء خبز مجوف. من أكون؟", answer: "شوربة البصل الفرنسية" },
            // قسم حيوانات
            { category: "حيوانات", question: "أنا ملك الغابة، صوتي زئير، وشعري كثيف. من أكون؟", answer: "الأسد" },
            { category: "حيوانات", question: "أنا أطول حيوان على وجه الأرض، ورقبتي طويلة جداً. من أكون؟", answer: "الزرافة" },
            { category: "حيوانات", question: "أنا حيوان بحري ضخم، أعيش في المحيطات وأنا أذكى الثدييات البحرية. من أكون؟", answer: "الدلفين" },
            { category: "حيوانات", question: "أنا طائر لا أستطيع الطيران، ولكنني أعدو بسرعة كبيرة وأعيش في المناطق الباردة. من أكون؟", answer: "البطريق" },
            // قسم بلدان
            { category: "بلدان", question: "أنا بلد الحرمين الشريفين، وأمتلك أكبر احتياطي نفط في العالم. من أكون؟", answer: "المملكة العربية السعودية" },
            { category: "بلدان", question: "أنا بلد الأهرامات العظيمة ونهر النيل الخالد. من أكون؟", answer: "مصر" },
            { category: "بلدان", question: "أنا بلد برج إيفل الشهير ومدينة النور. من أكون؟", answer: "فرنسا" },
            { category: "بلدان", question: "أنا بلد السور العظيم والتنين. من أكون؟", answer: "الصين" }
        ];

        let availableQuestions = []; // الأسئلة المتاحة للجولة الحالية

        // جلب العناصر الأساسية
        const welcomePopup = document.getElementById('welcome-popup'); //
        const tipsPopup = document.getElementById('tips-popup');
        const instructionsPopup = document.getElementById('instructions-popup');
        const setupScreen = document.getElementById('setup-screen');
        const scoreScreen = document.getElementById('score-screen');
        const questionScreen = document.getElementById('question-screen');
        const resultsScreen = document.getElementById('results-screen');

        const teamNamesInputsDiv = document.getElementById('team-names-inputs');
        const startGameBtn = document.getElementById('start-game-btn');
        const teamScoreBoard = document.getElementById('team-score-board');

        const questionInstruction = document.getElementById('question-instruction');
        const preQuestionTimerDisplay = document.getElementById('pre-question-timer');
        const questionTimerDisplay = document.getElementById('question-timer');
        const questionText = document.getElementById('question-text');
        const answerText = document.getElementById('answer-text');
        const questionScoreButtons = document.querySelector('.question-score-buttons');
        const nextRoundBtn = document.getElementById('next-round-btn');
        const endGameBtn = document.getElementById('end-game-btn');

        // وظائف إظهار وإخفاء النوافذ المنبثقة والشاشات
        function showPopup(popupElement) {
            popupElement.classList.add('active');
        }

        function hidePopup(popupElement) {
            popupElement.classList.remove('active');
        }

        function showScreen(screenElement) {
            const screens = [setupScreen, scoreScreen, questionScreen, resultsScreen];
            screens.forEach(screen => {
                if (screen === screenElement) {
                    screen.style.display = 'flex';
                } else {
                    screen.style.display = 'none';
                }
            });
        }

        // تسلسل ظهور النوافذ عند بدء التشغيل
        function showTipsPopupFromWelcome() { //
            hidePopup(welcomePopup); //
            showPopup(tipsPopup); //
        }

        function showInstructionsPopup() {
            hidePopup(tipsPopup);
            showPopup(instructionsPopup);
        }

        function hideInstructionsPopup() {
            hidePopup(instructionsPopup);
            showScreen(setupScreen);
        }

        // اختيار عدد اللاعبين
        function selectNumPlayers(num) {
            // إعادة تعيين الفرق والنقاط
            teams = Array.from({ length: num }, (_, i) => ({ name: `الفريق ${i + 1}`, score: 0 }));
            renderTeamNameInputs();
            startGameBtn.style.display = 'block'; // إظهار زر ابدأ اللعبة
        }

        // عرض حقول إدخال أسماء الفرق
        function renderTeamNameInputs() {
            teamNamesInputsDiv.innerHTML = '';
            teams.forEach((team, index) => {
                const group = document.createElement('div');
                group.className = 'team-input-group';

                const label = document.createElement('label');
                label.textContent = `اسم الفريق ${index + 1}:`;
                label.htmlFor = `team-name-${index}`;
                group.appendChild(label);

                const input = document.createElement('input');
                input.type = 'text';
                input.id = `team-name-${index}`;
                input.placeholder = `أدخل اسم الفريق ${index + 1}`;
                input.value = team.name; // تعيين الاسم الحالي كقيمة افتراضية
                group.appendChild(input);

                teamNamesInputsDiv.appendChild(group);
            });
        }

        // إعادة تسمية الفرق
        function renameTeams() {
            teams.forEach((team, index) => {
                const input = document.getElementById(`team-name-${index}`);
                if (input && input.value.trim() !== '') {
                    team.name = input.value.trim();
                }
            });
            // لا حاجة لإعادة رسم حقول الإدخال هنا، فالقيم محدثة بالفعل في الـ DOM
            alert('تم حفظ أسماء الفرق!');
        }

        // بدء اللعبة
        function startGame() {
            // تأكد من تحديث الأسماء الأخيرة قبل البدء
            renameTeams();
            showScreen(scoreScreen);
            renderScoreBoard();
            currentRound = 0; // إعادة تعيين الجولات
            updateNextRoundButtonText();
        }

        // عرض لوحة النقاط
        function renderScoreBoard() {
            teamScoreBoard.innerHTML = '';
            // تحديد تخطيط الشبكة بناءً على عدد الفرق
            if (teams.length === 2) { // 2 لاعبين (1x2 أو 2x1)
                teamScoreBoard.classList.remove('grid-2x2', 'grid-2-columns');
                teamScoreBoard.style.display = 'flex'; // استخدام flexbox لعرض صف واحد أو عمود واحد بشكل أفضل
                teamScoreBoard.style.flexDirection = 'row';
                teamScoreBoard.style.flexWrap = 'wrap'; // لضمان الالتفاف على الشاشات الصغيرة
            } else if (teams.length === 4) { // 4 لاعبين (2x2)
                teamScoreBoard.classList.add('grid-2x2');
                teamScoreBoard.classList.remove('grid-2-columns');
                teamScoreBoard.style.display = 'grid';
            } else if (teams.length === 6) { // 6 لاعبين (3x2)
                teamScoreBoard.classList.add('grid-2-columns');
                teamScoreBoard.classList.remove('grid-2x2');
                teamScoreBoard.style.display = 'grid';
            }

            teams.forEach((team, index) => {
                const card = document.createElement('div');
                card.className = `team-score-card team-${index}-card`; // إضافة فئة لون خاصة بالفريق
                
                const name = document.createElement('h3');
                name.textContent = team.name;
                card.appendChild(name);

                const scoreDisplay = document.createElement('div');
                scoreDisplay.className = 'score';
                scoreDisplay.textContent = team.score;
                card.appendChild(scoreDisplay);

                // أزرار إضافة النقاط
                const addScoreBtn = document.createElement('button');
                addScoreBtn.className = 'btn';
                addScoreBtn.textContent = '+1 نقطة';
                addScoreBtn.onclick = () => {
                    team.score++;
                    renderScoreBoard(); // تحديث لوحة النقاط فوراً
                };
                card.appendChild(addScoreBtn);

                teamScoreBoard.appendChild(card);
            });
        }

        // تحديث نص زر "بدء الجولة"
        function updateNextRoundButtonText() {
            if (currentRound < 4) { // هناك 4 جولات
                nextRoundBtn.textContent = `بدء الجولة ${currentRound + 1}`;
            } else {
                nextRoundBtn.textContent = 'الجولة الحاسمة'; // إذا تجاوزنا 4 جولات (للكسر التعادل)
            }
        }

        // بدء تسلسل السؤال (عداد ما قبل السؤال، عرض السؤال، عرض الإجابة)
        function startQuestionSequence() {
            if (currentRound >= 4 && !isTie()) { // إذا انتهت 4 جولات ولا يوجد تعادل
                endGame();
                return;
            }

            // إذا كانت الجولة الحاسمة (بعد الجولة 4)، اختر فئة عشوائية
            if (currentRound >= 4 && isTie()) {
                questionInstruction.textContent = 'الجولة الحاسمة: اختر الفائز واضف النقطة للفريق الفائز';
                questionInstruction.style.color = 'var(--primary-light-color)';
                const randomCategoryIndex = Math.floor(Math.random() * 4); // اختر فئة عشوائية (0-3)
                startNewQuestion(Object.keys(groupedQuestions)[randomCategoryIndex]); // ابدأ بسؤال من فئة عشوائية
                nextRoundBtn.style.display = 'none'; // أخفِ زر بدء الجولة
                endGameBtn.style.display = 'none'; // أخفِ زر إنهاء اللعب مؤقتاً
                return;
            }

            // الجولات العادية (1-4)
            currentRound++;
            updateNextRoundButtonText();
            questionInstruction.textContent = `الجولة ${currentRound}: استعداد...`;
            questionInstruction.style.color = 'var(--primary-light-color)'; // إعادة اللون إذا تغير في الجولة الحاسمة
            showScreen(questionScreen);
            resetQuestionDisplay();

            // إعداد الأسئلة للجولة الحالية
            availableQuestions = shuffleArray(questions).slice(0, 4); // خلط واختيار 4 أسئلة لكل جولة
            currentQuestionIndex = 0; // ابدأ دائماً من السؤال الأول في الجولة الجديدة
            startPreQuestionTimer();
        }


        // وظيفة لإعادة تعيين عرض السؤال
        function resetQuestionDisplay() {
            preQuestionTimerDisplay.style.display = 'none';
            questionTimerDisplay.style.display = 'none';
            questionText.textContent = '';
            answerText.textContent = '';
            questionScoreButtons.style.display = 'none';
            questionText.classList.remove('faded'); // إزالة بهتان النص
        }

        // عداد ما قبل السؤال
        let preQuestionTimerInterval;
        function startPreQuestionTimer() {
            let timeLeft = 5;
            preQuestionTimerDisplay.style.display = 'block';
            questionInstruction.textContent = `الجولة ${currentRound}: سؤال ${currentQuestionIndex + 1} (${availableQuestions[currentQuestionIndex].category}) - استعداد...`;

            preQuestionTimerDisplay.textContent = timeLeft;
            preQuestionTimerInterval = setInterval(() => {
                timeLeft--;
                preQuestionTimerDisplay.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(preQuestionTimerInterval);
                    preQuestionTimerDisplay.style.display = 'none';
                    startQuestionTimer();
                }
            }, 1000);
        }

        // عداد السؤال
        let questionTimerInterval;
        function startQuestionTimer() {
            let timeLeft = 20;
            questionTimerDisplay.style.display = 'block';
            questionText.textContent = availableQuestions[currentQuestionIndex].question;
            questionInstruction.textContent = `الجولة ${currentRound}: سؤال ${currentQuestionIndex + 1} (${availableQuestions[currentQuestionIndex].category}) - فكر بسرعة!`;
            
            questionTimerDisplay.textContent = timeLeft;
            questionTimerInterval = setInterval(() => {
                timeLeft--;
                questionTimerDisplay.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(questionTimerInterval);
                    showAnswer();
                }
            }, 1000);
        }

        // عرض الإجابة
        function showAnswer() {
            questionTimerDisplay.style.display = 'none';
            questionInstruction.textContent = `الجولة ${currentRound}: سؤال ${currentQuestionIndex + 1} (${availableQuestions[currentQuestionIndex].category}) - الإجابة هي:`;
            questionText.classList.add('faded'); // بهتان السؤال
            answerText.textContent = availableQuestions[currentQuestionIndex].answer;
            answerText.style.display = 'block';
            showScoreButtons(); // عرض أزرار النقاط
        }

        // عرض أزرار إضافة النقاط
        function showScoreButtons() {
            questionScoreButtons.innerHTML = '';
            teams.forEach((team, index) => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.textContent = `+1 لـ ${team.name}`;
                btn.onclick = () => {
                    team.score++;
                    renderScoreBoard(); // تحديث لوحة النقاط في الخلفية
                    moveToNextQuestionOrRound();
                };
                questionScoreButtons.appendChild(btn);
            });
            // إضافة زر للانتقال بدون نقاط
            const skipBtn = document.createElement('button');
            skipBtn.className = 'btn btn-continue-question';
            skipBtn.textContent = 'متابعة بدون نقاط';
            skipBtn.onclick = () => {
                moveToNextQuestionOrRound();
            };
            questionScoreButtons.appendChild(skipBtn);

            questionScoreButtons.style.display = 'flex';
        }

        // الانتقال إلى السؤال التالي أو الجولة التالية
        function moveToNextQuestionOrRound() {
            currentQuestionIndex++;
            if (currentQuestionIndex < availableQuestions.length) {
                // لا يزال هناك أسئلة في الجولة الحالية
                resetQuestionDisplay();
                startPreQuestionTimer();
            } else {
                // انتهت أسئلة الجولة، العودة لشاشة النقاط
                showScreen(scoreScreen);
                renderScoreBoard(); // للتأكد من تحديث النقاط المعروضة
                // إذا كانت هذه هي الجولة الحاسمة وانتهت، يجب إنهاء اللعب
                if (currentRound > 4 && !isTie()) {
                    endGame(); // إنهاء اللعب إذا لم يكن هناك تعادل بعد الجولة الحاسمة
                } else if (currentRound === 4) { // إذا انتهت الجولة 4
                    if (isTie()) {
                        nextRoundBtn.textContent = 'بدء الجولة الحاسمة';
                    } else {
                        endGame(); // إذا لم يكن هناك تعادل بعد الجولة 4، انهي اللعب
                    }
                }
            }
        }

        // التحقق من التعادل
        function isTie() {
            if (teams.length <= 1) return false; // لا تعادل إذا كان فريق واحد أو لا شيء

            const maxScore = Math.max(...teams.map(t => t.score));
            const teamsWithMaxScore = teams.filter(t => t.score === maxScore);
            return teamsWithMaxScore.length > 1; // تعادل إذا كان أكثر من فريق واحد لديهم نفس أعلى نقطة
        }

        // إنهاء اللعب وعرض النتائج
        function endGame() {
            showScreen(resultsScreen);
            displayFinalResults();
        }

        // عرض النتائج النهائية
        function displayFinalResults() {
            const finalScoresList = document.getElementById('final-scores-list');
            finalScoresList.innerHTML = '';
            
            // فرز الفرق تنازلياً حسب النقاط
            teams.sort((a, b) => b.score - a.score);

            // تحديد الفائز
            const winner = teams[0];
            const winnerMessageDiv = document.getElementById('winner-message');

            // التحقق من التعادل في النهاية
            if (isTie()) {
                winnerMessageDiv.innerHTML = `<span class="trophy-icon">🤝</span> تعادل بين الفرق!`;
            } else {
                winnerMessageDiv.innerHTML = `<span class="trophy-icon">🏆</span> الفائز هو: ${winner.name} بـ ${winner.score} نقطة!`;
            }

            // عرض نقاط جميع الفرق
            teams.forEach(team => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span>${team.name}</span> <span>${team.score} نقطة</span>`;
                finalScoresList.appendChild(listItem);
            });
        }

        // إعادة تعيين اللعبة
        function resetGame(fullReset) {
            if (fullReset) {
                // إعادة تعيين كامل للفرق والأسماء والأسئلة والجولات
                teams = [];
                currentRound = 0;
                currentQuestionIndex = 0;
                availableQuestions = [];
                teamNamesInputsDiv.innerHTML = ''; // مسح حقول الأسماء
                startGameBtn.style.display = 'none'; // إخفاء زر البدء
                showScreen(setupScreen); // العودة إلى شاشة الإعدادات
                updateNextRoundButtonText(); // إعادة تعيين نص زر الجولة
            } else {
                // إعادة تعيين النقاط فقط وإعادة بدء اللعبة بنفس الفرق
                teams.forEach(team => team.score = 0);
                currentRound = 0;
                currentQuestionIndex = 0;
                availableQuestions = [];
                showScreen(scoreScreen);
                renderScoreBoard();
                updateNextRoundButtonText();
            }
        }

        // دالة لخلط المصفوفة (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // تجميع الأسئلة حسب الفئة (لم تعد مستخدمة بنفس الشكل بعد التعديل لـ availableQuestions)
        const groupedQuestions = questions.reduce((acc, q) => {
            if (!acc[q.category]) {
                acc[q.category] = [];
            }
            acc[q.category].push(q);
            return acc;
        }, {});

        // عند تحميل الصفحة، أظهر النافذة الترحيبية
        document.addEventListener('DOMContentLoaded', (event) => {
            showPopup(welcomePopup); // بدء اللعبة بعرض نافذة الترحيب
            // تأكد من أن باقي النوافذ والشاشات مخفية في البداية
            hidePopup(tipsPopup);
            hidePopup(instructionsPopup);
            setupScreen.style.display = 'none';
            scoreScreen.style.display = 'none';
            questionScreen.style.display = 'none';
            resultsScreen.style.display = 'none';
        });

    </script>
</body>
</html>
