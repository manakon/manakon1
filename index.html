<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة من أكون؟</title>
    <style>

        /* الألوان الأساسية والمتغيرات */
        :root {
            --primary-dark-color: #776427; /* اللون البني الغامق الجديد */
            --primary-light-color: #D7C385; /* اللون البيج الفاتح الجديد */
            --text-color: #333; /* لون نص داكن للقراءة الجيدة على الخلفيات الفاتحة */
            --white-text-color: #FFF; /* لون نص أبيض للخلفيات الغامقة */
            
            /* تعديل: اللون الغامق الجديد بشفافية أكثر لخلفيات البوب أب */
            --popup-overlay-color: rgba(119, 100, 39, 0.9); /* اللون البني الغامق بشفافية 90% */
            /* تعديل: اللون الغامق الجديد بشفافية أكبر لبطاقات الشاشات الرئيسية (الأسئلة والنقاط) */
            --card-overlay-color: rgba(119, 100, 39, 0.6); /* اللون البني الغامق بشفافية 60% لظهور الخلفية */

            /* ألوان الفرق لبطاقات عرض النقاط - ألوان فاتحة جداً */
            --team1-card-color: rgba(144, 238, 144, 0.8); /* أخضر فاتح جداً */
            --team2-card-color: rgba(173, 216, 230, 0.8); /* أزرق فاتح جداً */
            --team3-card-color: rgba(255, 255, 153, 0.8); /* أصفر فاتح جداً */
            --team4-card-color: rgba(255, 192, 203, 0.8); /* وردي فاتح جداً */
            --team5-card-color: rgba(221, 160, 221, 0.8); /* بنفسجي فاتح جداً */
            --team6-card-color: rgba(135, 206, 235, 0.8); /* أزرق سماوي فاتح جداً */
        }

        /* أساسيات الجسم والخطوط */
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f4f4; /* خلفية الصفحة العامة */
            direction: rtl; /* لضمان عرض النص من اليمين لليسار */
            text-align: center; /* توسيط جميع النصوص بشكل افتراضي */
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto; /* تفعيل شريط التمرير للصفحة الرئيسية */
            position: relative; /* للسماح بوضع الخلفية المتناثرة */
        }

        /* خلفية أيقونات الاستفهام الضاحكة */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='80' font-size='90' text-anchor='middle' fill='%23776427' fill-opacity='0.1'%3E%3F%3C/text%3E%3C/svg%3E");
            background-size: 200px 200px; /* حجم الأيقونة الواحدة */
            opacity: 0.6; /* شفافية عامة للخلفية */
            z-index: -1; /* لجعلها خلف المحتوى */
        }

        /* التنبيهات والملاحظات العلوية */
        .top-note {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: var(--primary-dark-color); /* اللون الغامق الجديد */
            color: var(--white-text-color);
            padding: 10px 20px;
            text-align: center;
            font-size: 0.9em;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .top-note strong {
            color: red; /* تلوين كلمة "ملاحظة" بالأحمر */
        }

        /* الأنماط العامة للبطاقات (الشاشات الرئيسية) */
        .card {
            background-color: var(--card-overlay-color); /* اللون الغامق الجديد بشفافية عالية جداً */
            color: var(--white-text-color); /* نص أبيض عليها */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); /* ظل أغمق */
            text-align: center;
            width: 90%;
            max-width: 700px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-sizing: border-box;
            margin-top: 60px; /* مسافة من الملاحظة العلوية */
            margin-bottom: 20px;
            border: 2px solid var(--primary-light-color); /* حدود للبطاقات باللون الفاتح */
            position: relative; /* للسماح بتوسيط المحتوى الداخلي */
            overflow-y: auto; /* إضافة شريط تمرير لهذه البطاقات أيضاً */
        }
        .card h2, .card h3 {
            color: var(--primary-light-color); /* العناوين باللون الفاتح */
        }
        .card p, .card li, .card label {
            color: var(--white-text-color); /* النصوص باللون الأبيض */
        }

        /* الأنماط العامة للأزرار */
        .btn {
            background-color: var(--primary-dark-color);
            color: var(--white-text-color);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease, transform 0.1s ease;
            flex-shrink: 0; /* لمنع الأزرار من الانكماش */
        }

        .btn:hover {
            background-color: #927e3d; /* درجة أفتح قليلاً من اللون الغامق عند التفاعل */
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* النوافذ المنبثقة (Popups) */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--popup-overlay-color); /* اللون الغامق الجديد بشفافية عالية */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            overflow-y: auto; /* تفعيل شريط التمرير للنوافذ المنبثقة */
        }

        .popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .popup-content {
            background-color: var(--primary-light-color); /* اللون الفاتح الجديد */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            text-align: center;
            width: 95%;
            max-width: 600px;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            margin: 20px; /* مسافة من الحواف عند التمرير */
            border: 2px solid var(--primary-dark-color); /* حدود للبوب أب */
            max-height: 90vh; /* تحديد أقصى ارتفاع للمحتوى المنبثق */
            overflow-y: auto; /* تفعيل شريط التمرير على المحتوى نفسه داخل البوب أب */
        }

        .popup-overlay.active .popup-content {
            transform: scale(1);
        }

        .popup-content h2 {
            color: var(--primary-dark-color);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .popup-content ol, .popup-content ul {
            text-align: center; /* توسيط محتوى القوائم */
            margin: 20px auto;
            max-width: 80%;
            list-style-position: inside; /* لجعل الترقيم داخل المساحة المحددة */
            padding: 0; /* إزالة البادينج الافتراضي للقائمة */
        }
        .popup-content ul li {
            list-style: none; /* إزالة النقاط أو الأرقام للقوائم غير المرتبة */
            margin-bottom: 5px; /* تقليل المسافة بين عناصر القائمة */
        }

        .popup-content li {
            margin-bottom: 10px;
            line-height: 1.6;
            color: var(--text-color);
        }
        .popup-content p {
            color: var(--text-color);
        }
        
        /* شاشة الإعدادات */
        #setup-content-wrapper {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .team-selection-grid {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap; /* للسماح للأزرار بالانتقال لسطر جديد إذا ضاقت المساحة */
        }

        .team-selection-grid .btn {
            background-color: var(--primary-light-color);
            color: var(--primary-dark-color);
            border: 2px solid var(--primary-dark-color);
            padding: 10px 20px;
            font-size: 1em;
        }

        .team-selection-grid .btn:hover {
            background-color: #e6d8a7;
        }

        .team-names-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center; /* توسيط حقول إدخال أسماء الفرق */
        }

        .team-input-group {
            display: flex;
            flex-direction: column;
            align-items: center; /* توسيط العنوان وحقل الإدخال */
            gap: 5px;
            width: 100%;
            max-width: 300px; /* تحديد عرض أقصى لحقل الإدخال */
        }

        .team-input-group label {
            font-weight: bold;
            color: var(--primary-light-color); /* لون فاتح للعناوين */
        }

        .team-input-group input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--primary-light-color);
            border-radius: 5px;
            font-size: 1em;
            text-align: center; /* توسيط النص داخل حقول الإدخال */
            box-sizing: border-box;
            background-color: rgba(255, 255, 255, 0.2); /* حقول الإدخال شفافة قليلاً */
            color: var(--white-text-color); /* لون النص داخل الحقل */
        }
        .team-input-group input[type="text"]::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        /* شاشة النقاط */
        .score-board {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        /* تعديل: تنسيق Grid للفرق بناءً على العدد */
        .score-board.grid-2x2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        .score-board.grid-2-columns { /* تنسيق 3 صفوف و 2 عمود لـ 6 فرق */
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .team-score-card {
            /* تعديل: ألوان خلفية فاتحة جداً لكل فريق */
            background-color: rgba(215, 195, 133, 0.7); /* لون افتراضي إذا لم يتم تعيين لون خاص */
            color: var(--text-color);
            padding: 20px;
            border-radius: 10px;
            width: 180px; /* حجم ثابت للبطاقات */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 10px;
            min-height: 120px;
            border: 1px solid var(--primary-dark-color);
            transition: background-color 0.3s ease;
        }
        /* ألوان الخلفية لبطاقات النقاط لكل فريق - فاتحة جداً وشفافة */
        .team-score-card.team-0-card { background-color: var(--team1-card-color); }
        .team-score-card.team-1-card { background-color: var(--team2-card-color); }
        .team-score-card.team-2-card { background-color: var(--team3-card-color); }
        .team-score-card.team-3-card { background-color: var(--team4-card-color); }
        .team-score-card.team-4-card { background-color: var(--team5-card-color); }
        .team-score-card.team-5-card { background-color: var(--team6-card-color); }


        .team-score-card h3 {
            margin: 0;
            color: var(--primary-dark-color);
            font-size: 1.3em;
        }

        .team-score-card .score {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary-dark-color);
        }

        .score-screen-actions {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }

        /* شاشة الأسئلة */
        #question-screen .instruction-text {
            font-size: 1.2em;
            color: var(--primary-light-color);
            font-weight: bold;
        }

        #question-screen .timer-display {
            font-size: 3em;
            font-weight: bold;
            color: var(--primary-light-color);
            margin: 20px 0;
        }
        #question-screen .pre-question-timer {
            font-size: 4em; /* حجم أكبر لعداد بدء السؤال */
            font-weight: bold;
            color: var(--primary-light-color);
            margin: 20px 0;
        }

        #question-screen .question-text {
            font-size: 1.4em;
            min-height: 100px; /* مسافة كافية للسؤال */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            white-space: pre-wrap; /* للحفاظ على تنسيق الأسطر الجديدة */
            transition: color 0.5s ease;
            color: var(--white-text-color); /* لون نص السؤال */
        }

        #question-screen .question-text.faded {
            color: rgba(255, 255, 255, 0.6); /* بهتان النص ليكون شفافًا أكثر */
        }

        #question-screen .answer-text {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--primary-light-color);
            margin-top: 20px;
            min-height: 50px; /* مسافة كافية للإجابة */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .category-selection-buttons {
            display: none; /* مخفية لأن العداد سيحل محلها */
            justify-content: center;
            margin-top: 20px;
        }

        .question-score-buttons {
            display: none; /* مخفية افتراضياً */
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
        }

        .question-score-buttons .btn {
            color: var(--white-text-color); /* نص أبيض على الأزرار الملونة */
            border: 1px solid rgba(255,255,255,0.3); /* حدود بيضاء شفافة */
            padding: 10px 18px;
            font-size: 1em;
            font-weight: bold;
            /* إعادة الألوان الأصلية لأزرار إضافة النقاط */
            background-color: var(--primary-dark-color);
            color: var(--white-text-color);
            border: none;
        }
        /* إزالة قواعد الألوان الخاصة بالفرق من هنا، لتكون الأزرار موحدة */
        .question-score-buttons .btn:hover {
            background-color: #927e3d; /* لون التفاعل للأزرار الموحدة */
        }

        /* زر المتابعة بعد النقاط */
        .question-score-buttons .btn-continue-question {
            background-color: var(--primary-dark-color);
            color: var(--white-text-color);
            border: none;
        }
        .question-score-buttons .btn-continue-question:hover {
            background-color: #927e3d;
        }


        /* شاشة النتائج */
        .winner-message {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary-light-color);
            margin-bottom: 20px;
            display: flex; /* لتمكين توسيط الأيقونة والنص */
            flex-direction: column; /* ليكون الكأس فوق النص */
            align-items: center; /* توسيط أفقي */
            gap: 10px; /* مسافة بين الكأس والنص */
        }
        .winner-message .trophy-icon {
            font-size: 3em; /* حجم أكبر لأيقونة الكأس */
            color: gold; /* لون ذهبي للكأس */
            animation: bounceIn 0.8s ease-out; /* إضافة حركة دخول */
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        .final-scores-list {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 80%;
            max-width: 400px;
            margin: 0 auto 30px auto;
        }

        .final-scores-list li {
            background-color: rgba(215, 195, 133, 0.6); /* اللون الفاتح بشفافية متوسطة */
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
            color: var(--text-color);
            border: 1px solid var(--primary-dark-color);
        }

        .final-scores-list li span {
            font-weight: bold;
            color: var(--primary-dark-color);
        }

        .result-actions {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        /* الاستجابة للأجهزة الصغيرة */
        @media (max-width: 600px) {
            .card {
                padding: 20px;
                width: 95%;
            }

            .popup-content {
                padding: 20px;
            }

            .popup-content h2 {
                font-size: 1.5em;
            }

            .popup-content ol, .popup-content ul {
                max-width: 95%;
            }

            .btn {
                padding: 10px 20px;
                font-size: 1em;
            }

            .team-selection-grid {
                flex-direction: column;
                align-items: center;
            }

            .team-score-card {
                width: 100%;
                max-width: 250px;
            }

            /* في الأجهزة الصغيرة، دائمًا عمود واحد لبطاقات النتائج */
            .score-board.grid-2x2,
            .score-board.grid-2-columns {
                grid-template-columns: 1fr;
            }

            #question-screen .timer-display {
                font-size: 2.5em;
            }
            #question-screen .pre-question-timer {
                font-size: 3.5em; /* حجم أصغر لعداد بدء السؤال على الجوال */
            }

            #question-screen .question-text {
                font-size: 1.2em;
            }

            .winner-message {
                font-size: 1.5em;
            }
            .winner-message .trophy-icon {
                font-size: 2.5em;
            }
        }
 
    </style>

</head>
<body>

    <div class="top-note">
        <strong>ملاحظة:</strong> هذه النسخه لشخص واحد فقط وغير قابله للنشر او البيع ومن يخالف ذلك سيتم اتخاذ الإجراءات القانونيه في هذا الأمر وللتذكير بذمتك وأمانتك:
        "قال ﷺ "لا إيمان لمن لا أمانة له، ولا دين لمن لا عهد له"
    </div>

    <div class="top-note">...</div>
    <div id="tips-popup" class="popup-overlay">
        <div class="popup-content">
            <h2>نصيحة علشان نلعب ونستانس… بس بدون ما ننسى الأهم 🌙</h2>
            <ol>
                <li>⏰ "اللعب ممتع، بس خلّه بعد الصلاة، عشان ما تضيع عليك لا متعة ولا أجر."</li>
                <li>📖 "اللعبة حلوة، بس القرآن أحلى، خذ لك وقت بين الجولات وارتّح مع كلام الله."</li>
                <li>🙏 "إذا جاء وقت الصلاة، نوقف اللعب ونكسب رضا رب العالمين."</li>
                <li>✋ "نلعب ونضحك، لكن ما نخلي اللعب يلهينا عن طاعة الله."</li>
                <li>📚 "اللعبة جزء من يومنا، مو كل يومنا… لا تنسى أهدافك وطموحاتك."</li>
                <li>🎯 "اللعبة ما تمنع إنك تذاكر، نظّم وقتك وخلّ اللعب مكافأة بعد الإنجاز."</li>
                <li>⌛ "وقت المذاكرة غالي، لا تخليه يضيع على حساب جيم ممكن تلعبه بأي وقت."</li>
            </ol>
            <p style="text-align: center;">تذكر "إذا لعبت وانت محافظ على صلاتك واذكارك وقراءة القران وخلصت المذاكره والاشغال الي عليك … أنت كسبت الدنيا والآخرة بإذن الله"</p>
            <button class="btn" onclick="showInstructionsPopup()">التالي</button>
        </div>
    </div>

    <div id="instructions-popup" class="popup-overlay">
        <div class="popup-content">
            <h2>تعليمات لعبة "من أكون؟"</h2>
            <h3>💡 فكرة اللعبة:</h3>
            <p>"من أكون؟" هي لعبة جماعية تفاعلية تهدف إلى تنمية الذكاء وسرعة البديهة لدى اللاعبين. تعتمد اللعبة على قدرتك على تخمين شخصية أو عنصر معين من خلال مجموعة من الجمل الوصفية التي تُعرض لك.</p>
            <p>اللعبة مقسمة إلى أربعة أقسام متنوعة وممتعة، كل قسم يحتوي على أنواع مختلفة من الأسئلة:</p>
            <ul>
                <li>👤 <b>شخصيات مهمة</b>: أسئلة تدور حول شخصيات تاريخية، دينية، أو عامة معروفة.</li>
                <li>🍲 <b>طبخات</b>: أسئلة عن أطباق ومأكولات متنوعة من المطبخ العربي والعالمي.</li>
                <li>🐾 <b>حيوانات</b>: أسئلة تصف خصائص وسلوكيات حيوانات مختلفة.</li>
                <li>🗺️ <b>بلدان</b>: أسئلة تصف معالم، ثقافات، أو خصائص دول ومدن.</li>
            </ul>

            <h3>👥 عدد اللاعبين:</h3>
            <p>اللعبة مصممة للعب بين لاعبين أو فرق متعددة. عند بدء اللعبة، يمكنك اختيار عدد الفرق التي ستشارك، الخيارات المتاحة هي:</p>
            <ul>
                <li>فريقين.</li>
                <li>أربعة فرق.</li>
                <li>ستة فرق.</li>
            </ul>
            <p><b>ملاحظة</b>: إذا كنتم تلعبون كأفراد، يمكنكم اعتبار كل لاعب "فريقاً" بحد ذاته.</p>

            <h3>🧠 طريقة اللعب (كيف تلعب):</h3>
            <p>اللعبة بسيطة وممتعة، وتتبع الخطوات التالية في كل جولة:</p>
            <ul>
                <li><b>بدء الدور</b>: تبدأ اللعبة ببدء الجولة 1 وكل جولة سيظهر فيها 4 أسئلة من 4 أقسام مختلفة وهناك عداد للإجابة يجب الإجابة على السؤال قبل انتهاء العداد والفريق الذي يجيب إجابة صحيحة على السؤال يتم تسجيل نقطة له ثم متابعة إلى انتهاء الجولة 1 ومن ثم بدء جولة 2 وهكذا.</li>
                <li><b>شاشة السؤال</b>: ستظهر لك شاشة السؤال التي تمر بثلاث مراحل:
                    <ul>
                        <li><b>الاستعداد (5 ثوانٍ)</b>: يظهر عداد تنازلي مع توضيح السؤال من أي قسم.</li>
                        <li><b>عرض السؤال (20 ثانية)</b>: يظهر السؤال الوصفي على الشاشة مع عداد تنازلي. خلال هذه الفترة، يحاول الفريق الذي عليه الدور تخمين الإجابة بناءً على الجمل المعروضة. وعلى الفرق الإجابة قبل انتهاء العداد.</li>
                    </ul>
                </li>
                <li><b>عرض الإجابة الصحيحة</b>: بمجرد انتهاء العداد، ستظهر الإجابة الصحيحة على الشاشة.</li>
                <li><b>تسجيل النقاط</b>:
                    <ul>
                        <li>إذا كان تخمين الفريق صحيحاً، يُسجل له نقطة واحدة.</li>
                        <li>يمكن للفريق الآخر (أو للمشرف على اللعبة) إضافة النقطة يدوياً للفريق المستحق من شاشة النقاط.</li>
                    </ul>
                </li>
            </ul>

            <h3>📊 شاشة النقاط:</h3>
            <p>هذه هي الشاشة المحورية التي ستعود إليها بعد كل سؤال. تتكون شاشة النقاط من:</p>
            <ul>
                <li><b>مربعات الفرق</b>: لكل فريق مشارك، يوجد مربع خاص به بالاسم.</li>
                <li><b>عرض النقاط</b>: داخل كل مربع، يظهر اسم الفريق ونقاطه الحالية بخط كبير وواضح.</li>
            </ul>
            <p><b>الفائز</b> هو الفريق الذي حصل على أكبر عدد نقاط.</p>
            <p><b>في حال التعادل:</b></p>
            <p>هناك إمكانية "<b>بدء جولة حاسمة</b>": هذا الخيار "ابدأ الجولة الحاسمة" لكسر التعادل وليكون هناك فائز واحد.</p>
            <button class="btn" onclick="hideInstructionsPopup()">بدء الإعدادات</button>
        </div>
    </div>

    <div id="setup-screen" class="card">
        <h2>إعدادات اللعبة</h2>
        <div id="setup-content-wrapper">
            <h3>اختر عدد اللاعبين:</h3>
            <div class="team-selection-grid">
                <button class="btn" onclick="selectNumPlayers(2)">2 لاعبين</button>
                <button class="btn" onclick="selectNumPlayers(4)">4 لاعبين</button>
                <button class="btn" onclick="selectNumPlayers(6)">6 لاعبين</button>
            </div>

            <h3>تسمية الفرق:</h3>
            <div id="team-names-inputs" class="team-names-section">
            </div>
        </div>
        <button class="btn btn-dark" onclick="renameTeams()">إعادة تسمية الفرق</button>
        <button id="start-game-btn" class="btn" style="display: none;" onclick="startGame()">ابدأ اللعبة</button>
    </div>

    <div id="score-screen" class="card">
        <h2>شاشة النقاط</h2>
        <div id="team-score-board" class="score-board">
        </div>
        <div class="score-screen-actions">
            <button id="next-round-btn" class="btn btn-next-round" onclick="startQuestionSequence()">بدء الجولة 1</button>
            <button id="end-game-btn" class="btn btn-end-game" onclick="endGame()">إنهاء اللعب وعرض النتائج</button>
            <button id="reset-game-btn" class="btn btn-reset-game" onclick="resetGame(true)">إعادة تعيين</button>
        </div>
    </div>

    <div id="question-screen" class="card">
        <div class="instruction-text" id="question-instruction"></div>
        <div class="pre-question-timer" id="pre-question-timer" style="display: none;"></div>
        <div class="timer-display" id="question-timer"></div>
        <div class="question-text" id="question-text"></div>
        <div class="answer-text" id="answer-text"></div>
        <div class="category-selection-buttons">
            </div>
        <div id="question-score-buttons" class="question-score-buttons">
        </div>
    </div>

    <div id="result-screen" class="card">
        <h2>النتائج النهائية</h2>
        <div id="winner-display" class="winner-message"></div>
        <ul id="final-scores-list" class="final-scores-list">
        </ul>
        <div class="result-actions">
            <button class="btn btn-tie-breaker" style="display: none;">بدء جولة كسر التعادل (سؤال واحد)</button>
            <button class="btn btn-continue-game" onclick="continuePlaying()">متابعة اللعب</button>
            <button class="btn btn-end-game" onclick="resetGame(true)">إنهاء اللعب</button>
        </div>
    </div>


    <script>
        // * بيانات اللعبة (الأسئلة والأجوبة) *
        const gameQuestions = {
            'شخصيات': [
                {q: 'نبي كريم، وُلِد من غير أب، وكانت ولادته آية من الله، وتكلم في المهد، وأحيا الموتى بإذن الله، وكان بارًا بأمه، ورفعه الله إليه.\nمن أكون؟', a: 'عيسى بن مريم - عليه السلام'},
                {q: 'نبي وأب لاثني عشر ولدًا، رأى في المنام أن أحد أبنائه سيكون له شأن عظيم، فغار إخوته منه وألقوه في البئر، وبعد سنوات عاد إليه وقد جعله الله عزيزًا لمصر.\nمن أكون؟', a: 'يعقوب - عليه السلام'},
                {q: 'شاب شجاع، واجه جنديًا جبارًا اسمه جالوت وقتله، ثم أصبح نبيًا وملكًا، وأنزل الله عليه الزبور، وكان صوته جميلًا تتفاعل معه الجبال والطير.\nمن أكون؟', a: 'داوود - عليه السلام'},
                {q: 'تاجر غني من أوائل من دخلوا الإسلام، اشترى بلال بن رباح ليحرّره لله، وأنفق ماله كله في خدمة الدين، وكان رفيق النبي في الهجرة.\nمن أكون؟', a: 'أبو بكر الصديق - رضي الله عنه'},
                {q: 'شاب قويّ، استُشهد في معركة اليمامة، ولم يُعرف جسده بين الشهداء إلا بعلامة في يده، وجمع القرآن في قلبه قبل أن يُجمع رسميًا في مصحف.\nمن أكون؟', a: 'زيد بن الخطاب - رضي الله عنه'},
                {q: 'نبي حليم أُرسل إلى قوم مدين الذين كانوا يطفّفون في الميزان، دعاهم للعدل فرفضوا، فأخذتهم الصيحة وهم جاثمين.\nمن أكون؟', a: 'شعيب - عليه السلام'},
                {q: 'أحد العشرة المبشرين بالجنة، كان سهمه لا يُخطئ، ودعا له النبي بأن تُستجاب دعوته، وإذا أقسم على الله لأبرّه.\nمن أكون؟', a: 'سعد بن أبي وقاص - رضي الله عنه'},
                {q: 'نبي صابر ابتُلي بفقدان ماله وأولاده وصحته، لكنه لم ييأس، فدعا ربه: "رب إني مسّني الضر وأنت أرحم الراحمين"، فشفاه الله وردّ عليه نعمته.\nمن أكون؟', a: 'أيوب - عليه السلام'},
                {q: 'صبي خدم النبي في بيته، فدعا له بالبركة في المال والعمر والولد، فعاش طويلًا، وكثُر ماله وذريته، وكان محبوبًا من النبي.\nمن أكون؟', a: 'أنس بن مالك - رضي الله عنه'},
                {q: 'رجل قوي وعادل، أسلم بعد تحدٍّ شديد، وكان الإسلام عزًّا بعد إسلامه، لقّبه النبي بالفاروق، وكان يُفرّق بين الحق والباطل.\nمن أكون؟', a: 'عمر بن الخطاب - رضي الله عنه'},
                {q: 'نبي دعا ربه أن يُنزل مائدة من السماء لقومه، لتكون لهم عيدًا وآية، واستجاب الله دعاءه.\nمن أكون؟', a: 'عيسى - عليه السلام'},
                {q: 'نبي أرسله الله إلى قوم عاد، وكان قوي البنية، فدعاهم إلى عبادة الله، فكذّبوه، فأهلكهم الله بريح شديدة عاتيه.\nمن أكون؟', a: 'هود - عليه السلام'},
                {q: 'طفل رُمي في بئر بسبب حقد إخوته، نشأ في قصر عزيز مصر، وفسّر الأحلام، ثم صار وزيرًا يُدير خزائن البلاد.\nمن أكون؟', a: 'يوسف - عليه السلام'},
                {q: 'شاب معروف بحكمته، آتاه الله الحكمة وهو صغير، وسُخّرت له الطير والجن، وكان ملكًا ونبيًا، يُفهم لغة الحيوانات.\nمن أكون؟', a: 'سليمان - عليه السلام'},
                {q: 'نبي بنى سفينة بأمر الله، وسخر منه قومه، ثم حمل فيها من كل زوجين اثنين، ونجا من الطوفان العظيم.\nمن أكون؟', a: 'نوح - عليه السلام'},
                {q: 'صحابي قوي البنية، كان شديد الغيرة على الدين، دعا له النبي، ولقّبه "سيف الله المسلول"، وقاد المعارك ببطولة.\nمن أكون؟', a: 'خالد بن الوليد - رضي الله عنه'},
                {q: 'نبي كُلّف بدعوة فرعون، وكان فصيح اللسان شجاع القلب، شقّ الله له البحر، وأُنزل عليه التوراة.\nمن أكون؟', a: 'موسى - عليه السلام'},
                {q: 'صحابي شاب، كان حافظًا قويًا، كُلّف بجمع القرآن بعد وفاة عدد من الحفظة، وأشرف على كتابة المصحف.\nمن أكون؟', a: 'زيد بن ثابت - رضي الله عنه'},
                {q: 'صحابي، كان من صغار الصحابة، ونام في فراش النبي ليلة الهجرة فداءً له، وكان من أكثر الناس علمًا وشجاعة.\nمن أكون؟', a: 'علي بن أبي طالب - رضي الله عنه'},
                {q: 'نبي واجه قومه بقوة وثبات، ألقوه في النار، فكانت بردًا وسلامًا، وابتلي بأمر ذبح ابنه، ففداه الله.\nمن أكون؟', a: 'إبراهيم - عليه السلام'},
                {q: 'طلب منه قومه أن ينزل عليهم مائدة من السماء، فقال: "اللَّهُمَّ رَبَّنَا أَنزِلْ عَلَيْنَا مَائِدَةً مِّنَ السَّمَاءِ تَكُونُ لَنَا عِيدًا لِّأَوَّلِنَا وَآخِرِنَا وَآيَةً مِّنكَ ۖ وَارْزُقْنَا وَأَنتَ خَيْرُ الرَّازِقِينَ”؟ ', a: 'هو النّبي عيسى -عليه السلام'},
                {q: 'عالم جليل، وُلِد في الرياض وفَقَدَ بصره صغيرًا، لكنه أصبح من كبار العلماء والمفتين، تولّى رئاسة هيئة كبار العلماء ودار الإفتاء، وكان يُجيب على الأسئلة من جميع أنحاء العالم بصوته الهادئ، وله فضل كبير في نشر العقيدة الصحيحة.\nمن أكون؟', a: 'الشيخ عبدالعزيز بن باز - رحمه الله'},
                {q: 'عالم فقيه، وُلِد في عنيزة بالقصيم، عُرف بشرحه الواضح وتدرّجه في الطلب منذ صغره، له سلسلة دروس مشهورة في التفسير والحديث والعقيدة، وكان يُدرّس حتى أيامه الأخيرة، وله صوت محبب وشرح سهل ممتنع.\nمن أكون؟', a: 'الشيخ محمد بن صالح العثيمين - رحمه الله'},
                {q: 'عالم معاصر، عضو في هيئة كبار العلماء، وله مشاركات مؤثرة في وسائل الإعلام، يتميز بدقة الفتاوى وقوة البيان، وحرصه على التوجيه الشرعي للشباب والمجتمع، وله دروس منتظمة في التفسير والفقه والعقيدة.\nمن أكون؟', a: 'الشيخ صالح بن فوزان الفوزان - حفظه الله'},
                {q: 'إمام وخطيب للحرم المكي، صوته خاشع ومؤثر، تخرج من كلية الشريعة بجامعة الإمام، وشارك في الإمامة في المسجد الحرام منذ سنوات، وله كلمات مؤثرة قبل الخطب ومناسبات الحج.\nمن أكون؟', a: 'الشيخ ماهر المعيقلي'},
                {q: 'إمام للحرم المكي، عُرف بجمال التلاوة وقوة الحفظ، يحمل شهادة الدكتوراه في الفقه، وله أسلوب محكم في الخطبة، وتسجيلاته القرآنية تُبث على أوسع نطاق.\nمن أكون؟', a: 'الشيخ عبدالرحمن السديس'},
            ],
            'بلدان': [
                {q: 'يُعدّ مهد الإسلام، وفيه بيت الله الحرام، تهفو إليه قلوب المسلمين من كل مكان، ويحج إليه الملايين سنويًا.', a: 'السعودية'},
                {q: 'أرض النيلين، عُرفت بتاريخها العريق وحضارتها الكوشية، وأرضها خصبة تمتد على النيل، وتجمع بين العرب والأفارقة.', a: 'السودان'},
                {q: 'بلاد الأرز، فيها جبال وبحر وسهول، وهي من أجمل بلدان الشام، وتشتهر بمطبخها ومثقفيها.', a: 'لبنان'},
                {q: 'بلد الأهرامات وأم الدنيا، مرّ بها أنبياء كثيرون، وفيها نهر النيل الأزلي، والأزهر الشريف منارة العلم.', a: 'مصر'},
                {q: 'بلاد الزيتون، فيها قرى معلّقة على الجبال، وأرضها باركها الله، وهي مهد أنبياء كثر، وفيها المسجد الأقصى.', a: 'فلسطين'},
                {q: 'فيها جبال الشام وبحرها، تعرّضت لحروب كثيرة لكنها صامدة، وتجمع بين حضارات قديمة وحديثة.', a: 'سوريا'},
                {q: 'أرض قرطاج، وتاريخها غني بالثقافة والأصالة، ولها ساحل طويل على المتوسط، ومزيج حضاري فريد.', a: 'تونس'},
                {q: 'بلد الأندلسيين الأصل، فيها جبال الريف وسهول الأطلسي، وتشتهر بالصناعة التقليدية والمطبخ المتنوّع.', a: 'المغرب'},
                {q: 'أرض الشاوية والمزاب، فيها الصحراء الكبرى، وتعد من أكبر دول إفريقيا مساحة.', a: 'الجزائر'},
                {q: 'بلد صغير المساحة لكنه غنيّ بالثقافة، اشتهر بالتنوع والتسامح، وعاصمته المنامة.', a: 'البحرين'},
                {q: 'بلد على ضفاف الخليج، فيها ناطحات سحاب ومعالم حديثة، وتُعرف بتقدمها الاقتصادي والسياحي.', a: 'الإمارات العربية المتحدة'},
                {q: 'أرض الجبال الخضراء، وعاصمتها مسقط، تُعرف بالهدوء والعراقة والتقاليد العمانية.', a: 'عُمان'},
                {q: 'بلد بين الصحراء والبحر، عُرفت بتصدير اللؤلؤ قديمًا، وحاضن للثقافة والتراث.', a: 'قطر'},
                {q: 'بلد دجلة والفرات، مهد الحضارات البابلية، وتضم النجف وكربلاء وبغداد العريقة.', a: 'العراق'},
                {q: 'أرض سبأ ومعين، فيها صنعاء وعدن، وذكرت في القرآن، وهي مهد حضارات قديمة.', a: 'اليمن'},
                {q: 'بلد في شمال أفريقيا، عاصمتها نواكشوط، وأهلها يجمعون بين العربية والأمازيغية والإفريقية.', a: 'موريتانيا'},
                {q: 'من بلاد الشام، فيها نهر الأردن، وتضم آثارًا إسلامية عظيمة، مثل مقام النبي شعيب ومؤتة.', a: 'الأردن'},
                {q: 'بلد عربي في القرن الإفريقي، يطل على باب المندب، ويتميز بتنوع جغرافي وساحل طويل.', a: 'جيبوتي'},
                {q: 'عاصمتها مقديشو، تقع على القرن الإفريقي، وعُرفت بتجارتها البحرية منذ القدم.', a: 'الصومال'},
                {q: 'بلد الجبل الأسود والأبيض، في أقصى شمال أفريقيا، يتحدث أهله العربية والأمازيغية.', a: 'ليبيا'},
                {q: 'بلد عربي في الخليج، عاصمته الكويت، وله دور إعلامي وسياسي بارز، ويهتم بالعمل الإنساني.', a: 'الكويت'},
                {q: 'بلد عربي هادئ، اشتهر بجمال طبيعته وجزره الخلابة، ويتميّز بتنوع بيئي رائع.', a: 'جزر القمر'},
                {q: 'بلد عربي أفريقي صغير، عاصمته أسمرة، ويقع على ساحل البحر الأحمر.', a: 'إريتريا'},
                {q: 'بلد يتمتع بموقع استراتيجي هام بين أوروبا وإفريقيا، ويتحدث معظم سكانه العربية والتمازغت، وله تاريخ طويل من المقاومة.', a: 'الصحراء الغربية'},
                {q: 'بلد عربي يقع في شرق أفريقيا، ويشترك في الثقافتين العربية والسواحلية، عاصمته زنجبار.', a: 'تنزانيا'},
                {q: 'بلد مسلم ينتمي للاتحاد المغاربي، معروف بتقاليده الأصيلة وله طابع صحراوي مميز، وتشتهر بتجارة الجمال.', a: 'النيجر'},
            ],
            'طبخات': [
                {q: 'طبق أرز مع اللحم والتوابل، مشهور في الجزيرة العربية، ويُقدم في المناسبات والاحتفالات.', a: 'كبسة'},
                {q: 'معكرونة مغطاة بصلصة كريمية بيضاء مع الجبن، تُخبز في الفرن حتى تتحمر.', a: 'مكرونة بالبشاميل'},
                {q: 'مجموعة من اللحوم (دجاج، لحم، كباب) تُشوى على الفحم وتُقدم مع السلطات والخبز.', a: 'مشاوي'},
                {q: 'كرات مقلية من الحمص المهروس والبهارات، تُقدم كمقبلات مع الطحينة.', a: 'فلافل'},
                {q: 'شرائح لحم أو دجاج متبلة ومشوية، تُقدم عادة في خبز مع الخضار والصلصات.', a: 'شاورما'},
                {q: 'قطع رقيقه من العجين تطبخ مع اللحم والمرق والخضار.', a: 'مرقوق'},
                {q: 'نوع من العجين العربي التقليدي يُخبز في التنور أو على الصاج، رفيع ومقرمش.', a: 'خبز تنور'},
                {q: 'كرات لحم مفروم مكونة من اللحم والبرغل والتوابل، مقلية أو مقلية بالفرن.', a: 'كبة'},
                {q: 'خضار محشوة بالأرز واللحم المفروم، تُطهى في صلصة الطماطم.', a: 'محاشي'},
                {q: 'أوراق خضراء محشوة بالأرز والتوابل، تقدم باردة أو دافئة.', a: 'ورق عنب'},
                {q: 'خبز دائري رقيق مع طبقة من اللحم والصلصة والتوابل.', a: 'صفيحة لحم'},
                {q: 'دجاج مقلي بطلاء مقرمش، يُقدم كوجبة سريعة.', a: 'بروستد'},
                {q: 'شطيرة لحم مفروم أو دجاج مع الخضار والصلصات داخل خبز دائري.', a: 'برجر'},
                {q: 'طبق ياباني من شرائح السمك النيء أو المطبوخ مع الأرز المخلل وأوراق الأعشاب.', a: 'سوشي'},
                {q: 'طبق يُطهى في الفخار، عادة يحتوي على اللحم أو الدجاج مع الخضار والتوابل.', a: 'طاجن'},
                {q: 'طبق من الأرز مع العدس والمكرونة والبصل المقلي، يُقدم مع صلصة الطماطم.', a: 'كوشري'},
                {q: 'خبز رقيق محشو باللحم والبصل والبهارات، يُخبز أو يُقلى ويطبخ مع اللبن.', a: 'شاكريه'},
                {q: 'لفائف أرز مع خضار وسمك أو لحم مطهي، تُلف بورق النوري البحري.', a: 'كيمباب'},
                {q: 'طبق شعبي من المعكرونة المقلية مع الخضار والصلصة، سريع التحضير.', a: 'نودلز'},
                {q: 'مخلل مصنوع من الملفوف المخلل مع الفلفل الحار والثوم.', a: 'كيمتشي'},
                {q: 'حلوى صغيرة هشة مصنوعة من الدقيق والسكر والزبدة، تُقدم مع الشاي.', a: 'غريبة'},
                {q: 'حلوى سميد مبللة بالقطر ومحلاة، تُقدم في المناسبات.', a: 'بسبوسة'},
                {q: 'حلوى من الجبن أو القشطة مع الشعيرية المقرمشة، تُغطى بالقطر.', a: 'كنافة'},
                {q: 'مزيج من باذنجان مهروس مع الطحينة والليمون والثوم، يُقدم كمقبلات.', a: 'متبل'},
                {q: 'سلطة طازجة من البرغل والبندورة والخيار والبقدونس، مع زيت الزيتون والليمون.', a: 'تبولة'},
            ],
            'حيوانات': [
                {q: 'في الماء أعيش، ومن أنيابي تخاف الجموع، جلدي سميك، ووزني كبير، وزئيري يُسمع من بعيد.', a: 'فرس النهر'},
                {q: 'أعيش في الجبال، أُعرف بقوتي وقروني، أقفز فوق الصخور بمهارة، ولا تهمني الزحاليق أو الحجارة.', a: 'الوعل'},
                {q: 'صغير الحجم، سريع الخطى، يسرق الطعام بخفة، ويخزن المكسرات في الشقوق والزاوية.', a: 'السنجاب'},
                {q: 'أطير بلا ريش، أطارد الفريسة بصمت، وأملك رؤية حادة في الليل، وأصدر أصواتًا غريبة تثير الفضول.', a: 'الخُفاش'},
                {q: 'لي رقبة طويلة، آكل أوراق الشجر العالية، أملك نمطًا مرقّطًا على جسدي، ورشاقتي مذهلة رغم طولي.', a: 'الزرافة'},
                {q: 'أعيش في الصحراء، وأتحمل العطش والجوع، لي سنام يخزن الطاقة، وأسير بخُطى ثابتة.', a: 'الجمل'},
                {q: 'من أغرب الطيور، لا يطير لكنه يجري بسرعة، يعيش في أستراليا، وريشه كثيف وشكله فريد.', a: 'الإيمو'},
                {q: 'أطير في السماء، أُصدر صوت "صوصوصو"، أُحب التجمع على الأسلاك، وأهاجر لمسافات طوال.', a: 'السنونو'},
                {q: 'صغير وملون، أتنقل بين الأزهار، أبحث عن الرحيق برشاقة، وجناحيَّ يرفرفان بسرعة عجيبة.', a: 'طائر الطنان'},
                {q: 'لي درع قوي على ظهري، أتحرك ببطء، وأعيش طويلاً، وأحب الاسترخاء تحت الشمس.', a: 'السلحفاة'},
                {q: 'لا أُرى بسهولة، أتخفى بين الرمال، وسمّي قاتل، وأملك أنيابًا تلدغ بلا إنذار.', a: 'الأفعى'},
                {q: 'معروف بالضحك، أُصدر أصواتًا مرحة، وأعيش ضمن جماعات كبيرة، وأُخطط للصيد في الليل.', a: 'الضبع'},
                {q: 'صديق الإنسان في الغالب، ذكي ومرح، أنبح عند الخطر، وأحرس المنزل بإخلاص.', a: 'الكلب'},
                {q: 'قط لطيف، يحب النوم كثيرًا، يلعق فروه بهدوء، ويصدر "مواء" عند الجوع.', a: 'القط'},
                {q: 'لوني أسود وأبيض، أبدو كأنني أرتدي بدلة، أسبح ببراعة ولا أطير، وأعيش في القطب الجنوبي.', a: 'البطريق'},
                {q: 'سريع جدًا، ملك الغابة، زئيري يُرعب الجميع، أعيش وسط جماعة وأقود بقوة.', a: 'الأسد'},
                {q: 'أُعرف بنشاطي في الليل، وأمتلك وجهًا مستديرًا وعيونًا كبيرة، وصوتي "هوو هوو" معروف.', a: 'البومة'},
                {q: 'أعيش في البحر، لي 8 أذرع قوية، أغير لوني عند الحاجة، وأخرج حبرًا عند الخوف.', a: 'الأخطبوط'},
                {q: 'مشهورة بالتعاون والنظام، أعيش في مستعمرات، أحمل الطعام فوق ظهري، وأبني أنفاقًا مذهلة.', a: 'النملة'},
                {q: 'أعيش على الأشجار، ذيلي طويل وأقفز من غصن لغصن، وأحب الموز كثيرًا.', a: 'القرد'},
                {q: 'حجمي صغير، أُصدر صوت "زقزقة"، أعيش في الأقفاص أحيانًا، وأحب الحب والبذور.', a: 'العصفور'},
                {q: 'من فصيلة الدلافين، أُعتبر ذكيًا واجتماعيًا، أصدر أصواتًا للتواصل، وأقفز من الماء بسعادة.', a: 'الدلفين'},
                {q: 'أعيش في المستنقعات، فمي كبير وذو أسنان حادة، أُعرف بقوتي وسرعة انقضاضي، وأُخيف الجميع.', a: 'التمساح'},
                {q: 'مشهورة بالخفة والجمال، أُعرف بقروني الجميلة، أعيش في السهول وأجري بسرعة فائقة.', a: 'الغزالة'},
                {q: 'صغير وطريف، أحمل بيتي على ظهري، وأحب الأماكن الرطبة، وأسير ببطء شديد.', a: 'الحلزون'},
                {q: 'أعيش في البر والبحر، لي زعانف وذيل قوي، أقفز على الشواطئ أحيانًا، وأحب اللعب مع الأمواج.', a: 'الفقمة'},
            ]
        };

        const sectionNames = ['شخصيات', 'طبخات', 'حيوانات', 'بلدان'];
        
        let teams = [];
        let gameActive = false;
        let timerInterval;
        let preQuestionTimerInterval; // عداد بدء السؤال
        let currentQuestionObj = null; // السؤال الحالي المعروض
        let questionsShuffled = {}; // لتتبع الأسئلة التي تم خلطها واختيارها لكل قسم
        let originalQuestionsCopy = {}; // نسخة أصلية من الأسئلة لإعادة التعيين

        // متغيرات تتبع الجولة والقسم الحالي
        let currentRoundNumber = 1; // رقم الجولة الحالية
        let currentSectionIndexInRound = 0; // مؤشر القسم في الجولة الحالية (0=شخصيات، 1=طبخات، إلخ)
        let isTieBreakerRound = false; // لتحديد ما إذا كنا في جولة كسر التعادل

        // * دوال التحكم في الشاشات *
        function showScreen(screenId) {
            // إخفاء جميع الشاشات الأساسية (Cards)
            document.querySelectorAll('body > div.card').forEach(screen => {
                screen.style.display = 'none';
            });

            // إخفاء جميع النوافذ المنبثقة (Popups)
            document.querySelectorAll('body > div.popup-overlay').forEach(popup => {
                popup.classList.remove('active');
            });

            const screenToShow = document.getElementById(screenId);
            if (screenToShow) {
                if (screenToShow.classList.contains('popup-overlay')) {
                    screenToShow.classList.add('active');
                } else {
                    screenToShow.style.display = 'flex';
                }
            }
        }

        function showTipsPopup() {
            showScreen('tips-popup');
        }

        function showInstructionsPopup() {
            showScreen('instructions-popup');
        }

        function hideInstructionsPopup() {
            showScreen('setup-screen'); // بعد التعليمات، نذهب لشاشة الإعدادات
        }

        // * دوال إعداد اللعبة *
        function selectNumPlayers(num) {
            const teamNamesInputsDiv = document.getElementById('team-names-inputs');
            teamNamesInputsDiv.innerHTML = ''; // مسح أي حقول سابقة

            teams = []; // إعادة تهيئة الفرق
            for (let i = 0; i < num; i++) {
                teams.push({ name: `الفريق ${i + 1}`, score: 0 });
                const inputGroup = document.createElement('div');
                inputGroup.classList.add('team-input-group');
                inputGroup.innerHTML = `
                    <label for="teamName${i}">اسم الفريق ${i + 1}:</label>
                    <input type="text" id="teamName${i}" value="الفريق ${i + 1}" placeholder="أدخل اسم الفريق" />
                `;
                teamNamesInputsDiv.appendChild(inputGroup);
            }
            document.getElementById('start-game-btn').style.display = 'block'; // إظهار زر البدء
        }

        function renameTeams() {
            teams.forEach((team, index) => {
                const inputElement = document.getElementById(`teamName${index}`);
                if (inputElement) {
                    team.name = inputElement.value || `الفريق ${index + 1}`;
                }
            });
            alert('تم تحديث أسماء الفرق!');
        }

        function startGame() {
            if (teams.length === 0) {
                alert('الرجاء اختيار عدد اللاعبين أولاً.');
                return;
            }
            renameTeams();
            gameActive = true;
            // حفظ نسخة أصلية من الأسئلة
            for (const section in gameQuestions) {
                originalQuestionsCopy[section] = [...gameQuestions[section]];
            }
            // خلط الأسئلة لكل قسم مرة واحدة في البداية
            resetQuestionsShuffled(); // استخدام دالة جديدة لضمان إعادة الخلط

            // إعادة ضبط متغيرات الجولات والأقسام
            currentRoundNumber = 1;
            currentSectionIndexInRound = 0;
            isTieBreakerRound = false; // التأكد من عدم كونها جولة كسر تعادل في البداية
            updateNextRoundButtonText(); // تحديث نص الزر لأول مرة
            showScoreScreen();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function resetQuestionsShuffled() {
            questionsShuffled = {};
            for (const section in originalQuestionsCopy) {
                questionsShuffled[section] = shuffleArray([...originalQuestionsCopy[section]]);
            }
        }

        // * دوال شاشة النقاط *
        function showScoreScreen() {
            showScreen('score-screen');
            const scoreBoardDiv = document.getElementById('team-score-board');
            scoreBoardDiv.innerHTML = ''; // مسح لوحة النتائج القديمة

            // تطبيق تنسيق Grid بناءً على عدد الفرق
            scoreBoardDiv.classList.remove('grid-2x2', 'grid-2-columns'); // إزالة أي كلاسات سابقة
            if (teams.length === 4) {
                scoreBoardDiv.classList.add('grid-2x2'); // 2x2 لـ 4 فرق
            } else if (teams.length === 6) {
                scoreBoardDiv.classList.add('grid-2-columns'); // 2 أعمدة (3 صفوف) لـ 6 فرق
            }
            // لأي عدد آخر من الفرق، سيبقى flexbox التلقائي مع flex-wrap

            teams.forEach((team, index) => {
                const teamCard = document.createElement('div');
                teamCard.classList.add('team-score-card', `team-${index}-card`); // إضافة كلاس خاص بلون بطاقة الفريق
                teamCard.innerHTML = `
                    <h3>${team.name}</h3>
                    <div class="score" id="score-team-${index}">${team.score}</div>
                `;
                scoreBoardDiv.appendChild(teamCard);
            });
            // تحديث نص الزر بناءً على التقدم
            updateNextRoundButtonText();
        }

        // * دوال شاشة الأسئلة (المعدلة للمسار الخطي وإضافة النقاط) *

        // وظيفة لتحديث نص زر "بدء الجولة / متابعة"
        function updateNextRoundButtonText() {
            const nextRoundBtn = document.getElementById('next-round-btn');
            if (isTieBreakerRound) {
                nextRoundBtn.textContent = `بدء جولة كسر التعادل`;
                return;
            }

            if (currentSectionIndexInRound === 0 && currentRoundNumber === 1) {
                nextRoundBtn.textContent = `بدء الجولة ${currentRoundNumber}`;
            } else if (currentSectionIndexInRound < sectionNames.length) {
                nextRoundBtn.textContent = `متابعة`;
            } else { // بعد إتمام جميع الأقسام في جولة
                nextRoundBtn.textContent = `بدء الجولة ${currentRoundNumber + 1}`;
            }
        }

        // تبدأ تسلسل عرض السؤال (تُستدعى من زر "بدء الجولة / متابعة" في شاشة النقاط)
        function startQuestionSequence() {
            // التحقق من وجود أسئلة متبقية في أي قسم
            let questionsRemaining = false;
            for (const section in questionsShuffled) {
                if (questionsShuffled[section].length > 0) {
                    questionsRemaining = true;
                    break;
                }
            }

            if (!questionsRemaining && !isTieBreakerRound) { // فقط إذا لم تكن جولة كسر تعادل
                alert('لا توجد المزيد من الأسئلة في أي قسم. انتهت اللعبة!');
                endGame();
                return;
            }

            if (!isTieBreakerRound) { // منطق الجولات العادية
                // إذا انتهت أقسام الجولة الحالية (بعد المرور على الأقسام الأربعة)
                if (currentSectionIndexInRound >= sectionNames.length) {
                    currentRoundNumber++; // زيادة رقم الجولة
                    currentSectionIndexInRound = 0; // إعادة تعيين مؤشر القسم لأول القسم في الجولة الجديدة
                    updateNextRoundButtonText(); // تحديث نص الزر لبدء الجولة الجديدة
                }
            }
            
            showScreen('question-screen');
            document.getElementById('question-text').textContent = '';
            document.getElementById('answer-text').textContent = '';
            document.getElementById('question-timer').textContent = '';
            clearInterval(timerInterval); // إيقاف أي مؤقت نشط
            clearInterval(preQuestionTimerInterval); // إيقاف أي مؤقت سابق لبدء السؤال

            // إخفاء أزرار تسجيل النقاط
            document.getElementById('question-score-buttons').style.display = 'none';

            startPreQuestionCountdown(); // بدء العد التنازلي قبل عرض السؤال
        }

        function startPreQuestionCountdown() {
            let preTimeLeft = 5; // 5 ثوانٍ للعداد قبل السؤال
            const preTimerDisplay = document.getElementById('pre-question-timer');
            const questionInstruction = document.getElementById('question-instruction');

            preTimerDisplay.style.display = 'block';
            
            const categoryName = sectionNames[currentSectionIndexInRound];
            questionInstruction.textContent = `سؤال جديد في قسم "${categoryName}" سيبدأ بعد:`;

            preTimerDisplay.textContent = preTimeLeft;

            preQuestionTimerInterval = setInterval(() => {
                preTimeLeft--;
                preTimerDisplay.textContent = preTimeLeft;

                if (preTimeLeft <= 0) {
                    clearInterval(preQuestionTimerInterval);
                    preTimerDisplay.style.display = 'none'; // إخفاء العداد
                    questionInstruction.textContent = `الجولة ${currentRoundNumber} - قسم ${sectionNames[currentSectionIndexInRound]}`; // استعادة النص الأصلي
                    displayQuestion(); // عرض السؤال الفعلي
                }
            }, 1000);
        }


        // تعرض السؤال وتبدأ المؤقت (تُستدعى بعد انتهاء العد التنازلي لبدء السؤال)
        function displayQuestion() {
            const categoryName = sectionNames[currentSectionIndexInRound];
            const availableQuestions = questionsShuffled[categoryName];

            if (availableQuestions.length === 0) {
                alert(`لا توجد المزيد من الأسئلة في قسم "${categoryName}". سيتم الانتقال للقسم التالي في الجولة.`);
                // إذا كنا في جولة كسر تعادل وانتهت الأسئلة في هذا القسم، نختار قسماً عشوائياً آخر
                if (isTieBreakerRound) {
                    // ابحث عن أقسام لا تزال تحتوي على أسئلة
                    const non_empty_sections = sectionNames.filter(sec => questionsShuffled[sec].length > 0);
                    if (non_empty_sections.length > 0) {
                        currentSectionIndexInRound = sectionNames.indexOf(non_empty_sections[Math.floor(Math.random() * non_empty_sections.length)]);
                    } else {
                        alert('لا توجد أسئلة متبقية حتى لكسر التعادل. سيتم إنهاء اللعبة.');
                        endGame();
                        return;
                    }
                } else {
                    currentSectionIndexInRound++; // الانتقال للقسم التالي في الجولة العادية
                }
                startQuestionSequence(); // محاولة بدء السؤال التالي أو الجولة التالية
                return;
            }

            currentQuestionObj = availableQuestions.shift(); // إزالة السؤال بعد عرضه

            const questionTextElement = document.getElementById('question-text');
            questionTextElement.textContent = currentQuestionObj.q;
            questionTextElement.classList.remove('faded');
            questionTextElement.style.fontSize = '1.4em';

            let timeLeft = 20; // 20 ثانية للإجابة
            const timerDisplay = document.getElementById('question-timer');
            timerDisplay.textContent = timeLeft;

            clearInterval(timerInterval); // مسح أي مؤقت سابق

            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;

                if (timeLeft <= 5 && timeLeft > 0) {
                    questionTextElement.classList.add('faded');
                } else if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = 'انتهى الوقت!';
                    questionTextElement.classList.remove('faded');
                    questionTextElement.style.fontSize = '1.4em';
                    document.getElementById('answer-text').textContent = `الإجابة هي: ${currentQuestionObj.a}`;
                    
                    showScoreButtonsOnQuestionScreen(); // عرض أزرار تسجيل النقاط
                }
            }, 1000);
        }

        // تعرض أزرار تسجيل النقاط في شاشة السؤال
        function showScoreButtonsOnQuestionScreen() {
            const questionScoreButtonsDiv = document.getElementById('question-score-buttons');
            questionScoreButtonsDiv.innerHTML = ''; // مسح الأزرار القديمة

            teams.forEach((team, index) => {
                const addScoreBtn = document.createElement('button');
                addScoreBtn.classList.add('btn'); // إزالة كلاس اللون الخاص بالفريق من هنا
                addScoreBtn.textContent = ` ${team.name} (+1)`;
                addScoreBtn.onclick = () => {
                    addScoreFromQuestionScreen(index);
                };
                questionScoreButtonsDiv.appendChild(addScoreBtn);
            });

            // إضافة زر المتابعة في النهاية
            const continueBtn = document.createElement('button');
            continueBtn.classList.add('btn', 'btn-continue-question'); // استخدام كلاس مختلف لهذا الزر
            continueBtn.textContent = 'متابعة';
            continueBtn.onclick = continueToNextQuestionOrRound;
            questionScoreButtonsDiv.appendChild(continueBtn);

            questionScoreButtonsDiv.style.display = 'flex'; // إظهار الحاوية
        }

        // إضافة نقطة من شاشة السؤال
        function addScoreFromQuestionScreen(teamIndex) {
            if (currentQuestionObj) { 
                teams[teamIndex].score++;
                currentQuestionObj = null; // مسح السؤال لمنع إضافة نقاط متكررة
            } else {
                alert('لا يوجد سؤال نشط لإضافة نقطة إليه!');
            }
        }

        // الانتقال للسؤال التالي أو الجولة التالية بعد تسجيل النقاط
        function continueToNextQuestionOrRound() {
            currentQuestionObj = null; // التأكد من مسح السؤال لعدم إضافة نقاط لنفس السؤال
            clearInterval(timerInterval); // إيقاف المؤقت إذا كان لا يزال يعمل (في حال النقر قبل انتهاء الوقت)
            clearInterval(preQuestionTimerInterval); // إيقاف مؤقت بدء السؤال

            if (isTieBreakerRound) {
                // في جولة كسر التعادل، بعد السؤال الواحد نعود للنتائج النهائية
                isTieBreakerRound = false; // إعادة ضبط الحالة
                endGame(); // عرض النتائج النهائية مجداً
            } else {
                // في الجولات العادية، نزيد مؤشر القسم
                currentSectionIndexInRound++;
                showScoreScreen(); // العودة لشاشة النقاط لعرض النتائج ثم الضغط على "متابعة"
            }
        }


        // * دوال شاشة النتائج *
        function endGame() {
            gameActive = false;
            showScreen('result-screen');
            const finalScoresList = document.getElementById('final-scores-list');
            finalScoresList.innerHTML = '';
            
            // فرز الفرق حسب النقاط تنازلياً
            const sortedTeams = [...teams].sort((a, b) => b.score - a.score);

            sortedTeams.forEach(team => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `${team.name}: <span>${team.score} نقطة</span>`;
                finalScoresList.appendChild(listItem);
            });

            // تحديد الفائز أو التعادل
            const winnerDisplay = document.getElementById('winner-display');
            const tieBreakerBtn = document.querySelector('#result-screen .btn-tie-breaker');
            
            // إخفاء زر كسر التعادل مبدئياً
            tieBreakerBtn.style.display = 'none';

            if (sortedTeams.length > 0) {
                const maxScore = sortedTeams[0].score;
                const winners = sortedTeams.filter(team => team.score === maxScore);

                if (winners.length === 1) {
                    // إضافة أيقونة الكأس وعبارة التهنئة
                    winnerDisplay.innerHTML = `<span class="trophy-icon">🏆</span><br>مبروك الفريق **${winners[0].name}** هو الفائز بـ ${winners[0].score} نقطة!`;
                } else {
                    winnerDisplay.textContent = `تعادل بين: ${winners.map(w => w.name).join(', ')} بـ ${maxScore} نقطة!`;
                    tieBreakerBtn.style.display = 'block'; // إظهار زر جولة كسر التعادل
                    tieBreakerBtn.onclick = () => {
                        isTieBreakerRound = true;
                        // اختيار قسم عشوائي لجولة كسر التعادل
                        const non_empty_sections = sectionNames.filter(sec => questionsShuffled[sec].length > 0);
                        if (non_empty_sections.length > 0) {
                            currentSectionIndexInRound = sectionNames.indexOf(non_empty_sections[Math.floor(Math.random() * non_empty_sections.length)]);
                            startQuestionSequence(); // بدء تسلسل السؤال لجولة كسر التعادل
                        } else {
                            alert('لا توجد أسئلة متبقية لكسر التعادل. سيتم إنهاء اللعبة.');
                            resetGame(true); // إنهاء اللعب بالكامل
                        }
                    };
                }
            } else {
                winnerDisplay.textContent = 'لم يتم لعب أي جولات بعد.';
            }
        }

        // متابعة اللعب من شاشة النتائج (العودة لشاشة النقاط)
        function continuePlaying() {
            showScoreScreen();
        }

        // إعادة تعيين اللعبة بالكامل
        // isFullReset: true لإعادة التعيين بالكامل والعودة لشاشة الإعدادات، false فقط لتصفير النقاط والأسئلة (غير مستخدمة حاليًا لكن مفيدة)
        function resetGame(isFullReset = true) {
            teams.forEach(team => team.score = 0); // تصفير النقاط
            gameActive = false;
            clearInterval(timerInterval);
            clearInterval(preQuestionTimerInterval);
            currentQuestionObj = null;
            resetQuestionsShuffled(); // إعادة خلط الأسئلة من جديد
            currentRoundNumber = 1; // إعادة ضبط رقم الجولة
            currentSectionIndexInRound = 0; // إعادة ضبط مؤشر القسم
            isTieBreakerRound = false; // إعادة ضبط حالة كسر التعادل
            
            if (isFullReset) {
                // إعادة تهيئة أسماء الفرق في واجهة المستخدم
                const teamNamesInputsDiv = document.getElementById('team-names-inputs');
                teamNamesInputsDiv.innerHTML = ''; // مسح حقول الأسماء القديمة
                teams = []; // مسح الفرق تمامًا
                document.getElementById('start-game-btn').style.display = 'none'; // إخفاء زر البدء
                showScreen('setup-screen'); // العودة لشاشة الإعداد
            } else {
                // في حالة عدم إعادة التعيين الكامل (غير مستخدمة حاليًا)
                showScoreScreen(); // العودة لشاشة النقاط بعد تصفيرها
            }
            document.querySelector('.category-selection-buttons').style.display = 'none'; // إخفاء أزرار الفئات
            document.getElementById('question-score-buttons').style.display = 'none'; // إخفاء أزرار تسجيل النقاط
            document.getElementById('next-round-btn').textContent = 'بدء الجولة 1'; // إعادة نص زر الجولة
        }


        // * تنفيذ عند تحميل الصفحة *
        document.addEventListener('DOMContentLoaded', (event) => {
            showTipsPopup(); // بدء اللعبة بعرض نافذة النصائح (نافذة 1)
        });

    </script>
</body>
</html>









